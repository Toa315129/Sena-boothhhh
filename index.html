<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SENA PHOTOBOOTH</title>

<link href="https://fonts.googleapis.com/css2?family=Gaegu:wght@400;700&display=swap" rel="stylesheet">

<style>
:root{
  --cream:#FFF7DD;
  --blue:#E9F1FF;
  --ink:#1F2A44;
  --paper:#fffdf4;
}

*{box-sizing:border-box;}

body{
  margin:0;
  height:100vh;
  font-family:'Gaegu', cursive;
  background:
    repeating-linear-gradient(
      0deg,
      rgba(0,0,0,0.02),
      rgba(0,0,0,0.02) 1px,
      transparent 1px,
      transparent 4px
    ),
    var(--cream);
  color:var(--ink);
}

.screen{display:none;width:100%;height:100%;}
.screen.active{display:flex;}
.center{justify-content:center;align-items:center;flex-direction:column;text-align:center;}

.star{
  width:22px;height:22px;background:var(--ink);
  clip-path:polygon(
    50% 0%,60% 40%,100% 50%,60% 60%,
    50% 100%,40% 60%,0% 50%,40% 40%
  );
  transform:rotate(12deg);
}

button{
  font-family:'Gaegu';
  padding:16px 36px;
  font-size:24px;
  border-radius:999px;
  border:4px solid var(--ink);
  background:var(--blue);
}
button:active{transform:scale(.95) rotate(-1deg);}

.circle-btn{
  width:96px;height:96px;
  border-radius:50%;
  font-size:38px;
  background:white;
}

/* START */
#start h1{font-size:46px;}
#start p{font-size:22px;margin-bottom:28px;}

/* BOOTH */
.booth{
  display:flex;
  gap:16px;
  padding:16px;
  width:100%;
}

.camera-box{
  width:58%;
  background:var(--paper);
  border:4px solid var(--ink);
  border-radius:32px;
  padding:12px;
  position:relative;
}

.camera-frame{
  width:100%;
  height:420px; /* üîΩ ‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á */
  border:4px dashed var(--ink);
  border-radius:28px;
  overflow:hidden;
}

video{
  width:100%;
  height:100%;
  object-fit:cover;
}

#camStatus{
  position:absolute;
  top:10px;
  left:16px;
  font-size:18px;
}

#countdown{
  position:absolute;
  inset:0;
  display:none;
  justify-content:center;
  align-items:center;
  font-size:88px;
  color:white;
  text-shadow:4px 4px var(--ink);
}

.preview{
  width:42%;
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
}

.preview canvas{
  background:white;
  border:4px solid var(--ink);
  border-radius:20px;
  width:100%;
  height:200px; /* üîΩ ‡∏¢‡πà‡∏≠ */
}

/* RESULT */
#final{
  background:white;
  border:4px solid var(--ink);
  border-radius:32px;
}
</style>
</head>

<body>

<!-- START -->
<div id="start" class="screen active center">
  <div class="star"></div>
  <h1>SENA PHOTOBOOTH</h1>
  <p>‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ñ‡πà‡∏≤‡∏¢ üì∏</p>
  <button onclick="goMode()">START</button>
</div>

<!-- MODE -->
<div id="mode" class="screen center">
  <h2>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î‡∏†‡∏≤‡∏û</h2>
  <button onclick="selectMode('color')">COLOR</button><br><br>
  <button onclick="selectMode('mono')">MONO</button>
</div>

<!-- BOOTH -->
<div id="booth" class="screen">
  <div class="booth">

    <div class="camera-box">
      <div id="camStatus">‚óè CAMERA ON</div>
      <div class="camera-frame">
        <video id="video" autoplay playsinline></video>
      </div>
      <div id="countdown">3</div>
    </div>

    <div class="preview">
      <canvas width="240" height="320"></canvas>
      <canvas width="240" height="320"></canvas>
      <canvas width="240" height="320"></canvas>
      <canvas width="240" height="320"></canvas>
    </div>
  </div>

  <div class="center">
    <div style="display:flex;gap:14px;flex-wrap:wrap;">
      <button onclick="toggleCamera()">CAMERA</button>
      <button onclick="toggleMode()">MODE</button>
      <button class="circle-btn" onclick="startShoot()">‚óè</button>
    </div>
  </div>
</div>

<!-- RESULT -->
<div id="result" class="screen center">
  <canvas id="final" width="420" height="1350"></canvas><br>
  <button onclick="download()">DOWNLOAD</button><br><br>
  <button onclick="reset()">FINISH</button>
</div>

<script>
const screens=document.querySelectorAll('.screen');
const video=document.getElementById('video');
const previews=document.querySelectorAll('.preview canvas');
const cd=document.getElementById('countdown');
const final=document.getElementById('final');
const fctx=final.getContext('2d');
const camStatus=document.getElementById('camStatus');

let mode='color';
let shots=[];
let stream=null;

function show(id){
  screens.forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}
function goMode(){show('mode');}

function selectMode(m){
  mode=m;
  show('booth');
  startCamera();
}

function startCamera(){
  navigator.mediaDevices.getUserMedia({video:{facingMode:'user'}})
    .then(s=>{
      stream=s;
      video.srcObject=s;
      camStatus.textContent='‚óè CAMERA ON';
    });
}

function toggleCamera(){
  if(stream){
    stream.getTracks().forEach(t=>t.stop());
    stream=null;
    camStatus.textContent='‚óã CAMERA OFF';
  }else startCamera();
}

function toggleMode(){
  mode=mode==='color'?'mono':'color';
  alert('MODE: '+mode.toUpperCase());
}

/* üî¥ ‡∏à‡∏≤‡∏Å 3 ‚Üí 4 ‡∏£‡∏π‡∏õ */
function startShoot(){
  shots=[];
  previews.forEach(c=>c.getContext('2d').clearRect(0,0,c.width,c.height));
  take(0);
}

function take(i){
  if(i>=4){makeFinal();return;}
  let t=3;
  cd.style.display='flex';
  cd.textContent=t;
  const timer=setInterval(()=>{
    t--;cd.textContent=t;
    if(t===0){
      clearInterval(timer);
      cd.style.display='none';
      capture(i);
      setTimeout(()=>take(i+1),500);
    }
  },1000);
}

function capture(i){
  const temp=document.createElement('canvas');
  temp.width=video.videoWidth;
  temp.height=video.videoHeight;
  const ctx=temp.getContext('2d');
  ctx.drawImage(video,0,0);

  if(mode==='mono'){
    const img=ctx.getImageData(0,0,temp.width,temp.height);
    for(let p=0;p<img.data.length;p+=4){
      const g=img.data[p]*0.3+img.data[p+1]*0.59+img.data[p+2]*0.11;
      img.data[p]=img.data[p+1]=img.data[p+2]=g;
    }
    ctx.putImageData(img,0,0);
  }

  shots.push(temp);
  drawCover(previews[i].getContext('2d'),temp,0,0,240,320);
}

function makeFinal(){
  show('result');
  fctx.fillStyle='white';
  fctx.fillRect(0,0,420,1350);

  /* üî• ‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô */
  fctx.font='38px Gaegu';
  fctx.textAlign='center';
  fctx.fillStyle='#000';
  fctx.fillText('SENAPHOTOBOOTH',210,70);

  let y=110;
  shots.forEach(s=>{
    drawCover(fctx,s,40,y,340,220);
    y+=250;
  });

  fctx.font='26px Gaegu';
  fctx.fillText('@saphasena68',210,1300);
}

function drawCover(ctx,img,x,y,w,h){
  const ir=img.width/img.height;
  const tr=w/h;
  let sx,sy,sw,sh;
  if(ir>tr){sh=img.height;sw=sh*tr;sx=(img.width-sw)/2;sy=0;}
  else{sw=img.width;sh=sw/tr;sx=0;sy=(img.height-sh)/2;}
  ctx.drawImage(img,sx,sy,sw,sh,x,y,w,h);
}

function download(){
  const a=document.createElement('a');
  a.href=final.toDataURL('image/png');
  a.download='SENA_PHOTOBOOTH.png';
  a.click();
}
function reset(){show('start');}
</script>

</body>
</html>
