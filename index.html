<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SENA PHOTOBOOTH</title>

<link href="https://fonts.googleapis.com/css2?family=Gaegu:wght@400;700&display=swap" rel="stylesheet">

<style>
/* =================================================
   THEME ‚Äì Korean DIY / Hand-drawn
================================================= */
:root{
  --cream:#FFF7DD;
  --blue:#E9F1FF;
  --ink:#1F2A44;
  --paper:#fffdf4;
}

*{box-sizing:border-box;}

body{
  margin:0;
  height:100vh;
  font-family:'Gaegu', cursive;
  background:
    repeating-linear-gradient(
      0deg,
      rgba(0,0,0,0.02),
      rgba(0,0,0,0.02) 1px,
      transparent 1px,
      transparent 4px
    ),
    var(--cream);
  color:var(--ink);
}

/* =================================================
   SCREEN SYSTEM
================================================= */
.screen{
  display:none;
  width:100%;
  height:100%;
}
.screen.active{
  display:flex;
}

.center{
  justify-content:center;
  align-items:center;
  flex-direction:column;
  text-align:center;
}

/* =================================================
   DOODLES & STARS
================================================= */
.star{
  width:22px;
  height:22px;
  background:var(--ink);
  clip-path:polygon(
    50% 0%, 60% 40%, 100% 50%, 60% 60%,
    50% 100%, 40% 60%, 0% 50%, 40% 40%
  );
  transform:rotate(12deg);
}

.doodle{
  position:absolute;
  font-size:20px;
  opacity:.6;
}

/* =================================================
   BUTTONS (Sticker Style)
================================================= */
button{
  font-family:'Gaegu';
  padding:18px 40px;
  font-size:26px;
  border-radius:999px;
  border:4px solid var(--ink);
  background:var(--blue);
  transition:.2s;
}
button:active{
  transform:scale(.95) rotate(-1deg);
}

.circle-btn{
  width:110px;
  height:110px;
  border-radius:50%;
  font-size:42px;
  background:white;
}

/* =================================================
   START
================================================= */
#start h1{
  font-size:48px;
  margin-bottom:10px;
}
#start p{
  font-size:22px;
  margin-bottom:30px;
}

/* =================================================
   BOOTH
================================================= */
.booth{
  display:flex;
  gap:20px;
  padding:20px;
}

.camera-box{
  width:60%;
  background:var(--paper);
  border:4px solid var(--ink);
  border-radius:36px 32px 34px 30px;
  padding:14px;
  position:relative;
}

.camera-frame{
  width:100%;
  height:100%;
  border:4px dashed var(--ink);
  border-radius:30px;
  overflow:hidden;
}

video{
  width:100%;
  height:100%;
  object-fit:cover;
}

/* CAMERA STATUS */
#camStatus{
  position:absolute;
  top:14px;
  left:18px;
  font-size:18px;
}

/* COUNTDOWN */
#countdown{
  position:absolute;
  inset:0;
  display:none;
  justify-content:center;
  align-items:center;
  font-size:96px;
  color:white;
  text-shadow:4px 4px var(--ink);
  animation:pop .4s ease;
}
@keyframes pop{
  0%{transform:scale(.7);}
  100%{transform:scale(1);}
}

/* PREVIEW */
.preview{
  width:40%;
  display:flex;
  flex-direction:column;
  gap:14px;
}

.preview canvas{
  background:white;
  border:4px solid var(--ink);
  border-radius:22px;
  height:30%;
  transition:.3s;
}
.preview canvas.filled{
  animation:appear .4s ease;
}
@keyframes appear{
  from{transform:scale(.8); opacity:.5;}
  to{transform:scale(1); opacity:1;}
}

/* =================================================
   RESULT
================================================= */
#final{
  background:white;
  border:4px solid var(--ink);
  border-radius:32px 28px 34px 30px;
}
</style>
</head>

<body>

<!-- ================= START SCREEN ================= -->
<div id="start" class="screen active center">
  <div class="star"></div>
  <h1>SENA PHOTOBOOTH</h1>
  <p>‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ñ‡πà‡∏≤‡∏¢ üì∏</p>
  <button onclick="goMode()">START</button>
  <div class="doodle" style="bottom:20px;">‚ò∫Ô∏é ‚úø ‚òÖ</div>
</div>

<!-- ================= MODE SELECT ================= -->
<div id="mode" class="screen center">
  <h2>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î‡∏†‡∏≤‡∏û</h2>
  <button onclick="selectMode('color')">COLOR</button><br><br>
  <button onclick="selectMode('mono')">MONO</button>
</div>

<!-- ================= BOOTH ================= -->
<div id="booth" class="screen">
  <div class="booth">

    <div class="camera-box">
      <div id="camStatus">‚óè CAMERA ON</div>

      <div class="camera-frame">
        <video id="video" autoplay playsinline></video>
      </div>
      <div id="countdown">3</div>
    </div>

    <div class="preview">
      <canvas width="240" height="320"></canvas>
      <canvas width="240" height="320"></canvas>
      <canvas width="240" height="320"></canvas>
    </div>
  </div>

  <div class="center">
    <div style="display:flex; gap:14px; flex-wrap:wrap; justify-content:center;">
      <button onclick="toggleCamera()">CAMERA</button>
      <button onclick="toggleMode()">MODE</button>
      <button class="circle-btn" onclick="startShoot()">‚óè</button>
    </div>
  </div>
</div>

<!-- ================= RESULT ================= -->
<div id="result" class="screen center">
  <canvas id="final" width="420" height="1100"></canvas><br>
  <button onclick="download()">DOWNLOAD</button><br><br>
  <button onclick="reset()">FINISH</button>
</div>

<script>
/* =================================================
   GLOBAL STATE (‡πÄ‡∏î‡∏¥‡∏° + ‡πÄ‡∏û‡∏¥‡πà‡∏°)
================================================= */
const screens=document.querySelectorAll('.screen');
const video=document.getElementById('video');
const previews=document.querySelectorAll('.preview canvas');
const cd=document.getElementById('countdown');
const final=document.getElementById('final');
const fctx=final.getContext('2d');
const camStatus=document.getElementById('camStatus');

let mode='color';
let shots=[];
let stream=null;

/* =================================================
   SCREEN CONTROL (‡πÄ‡∏î‡∏¥‡∏°)
================================================= */
function show(id){
  screens.forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}
function goMode(){ show('mode'); }

/* =================================================
   CAMERA CONTROL (‡πÄ‡∏û‡∏¥‡πà‡∏°)
================================================= */
function selectMode(m){
  mode=m;
  show('booth');
  startCamera();
}

function startCamera(){
  navigator.mediaDevices.getUserMedia({video:{facingMode:'user'}})
    .then(s=>{
      stream=s;
      video.srcObject=s;
      camStatus.textContent='‚óè CAMERA ON';
    });
}

function toggleCamera(){
  if(stream){
    stream.getTracks().forEach(t=>t.stop());
    stream=null;
    camStatus.textContent='‚óã CAMERA OFF';
  }else{
    startCamera();
  }
}

/* =================================================
   MODE TOGGLE (‡πÄ‡∏û‡∏¥‡πà‡∏°)
================================================= */
function toggleMode(){
  mode = mode==='color'?'mono':'color';
  alert('MODE: '+mode.toUpperCase());
}

/* =================================================
   SHOOT FLOW (‡πÄ‡∏î‡∏¥‡∏°)
================================================= */
function startShoot(){
  shots=[];
  previews.forEach(c=>{
    c.classList.remove('filled');
    c.getContext('2d').clearRect(0,0,c.width,c.height);
  });
  take(0);
}

function take(i){
  if(i>=3){ makeFinal(); return; }

  let t=3;
  cd.style.display='flex';
  cd.textContent=t;

  const timer=setInterval(()=>{
    t--;
    cd.textContent=t;
    beep();
    if(t===0){
      clearInterval(timer);
      cd.style.display='none';
      capture(i);
      setTimeout(()=>take(i+1),500);
    }
  },1000);
}

/* =================================================
   CAPTURE (MONO REAL ‚Äì ‡πÄ‡∏î‡∏¥‡∏°)
================================================= */
function capture(i){
  playShutter();
  const temp=document.createElement('canvas');
  temp.width=video.videoWidth;
  temp.height=video.videoHeight;
  const ctx=temp.getContext('2d');
  ctx.drawImage(video,0,0);

  if(mode==='mono'){
    const img=ctx.getImageData(0,0,temp.width,temp.height);
    for(let p=0;p<img.data.length;p+=4){
      const g=img.data[p]*0.3+img.data[p+1]*0.59+img.data[p+2]*0.11;
      img.data[p]=img.data[p+1]=img.data[p+2]=g;
    }
    ctx.putImageData(img,0,0);
  }

  shots.push(temp);
  drawCover(previews[i].getContext('2d'),temp,0,0,240,320);
  previews[i].classList.add('filled');
}

/* =================================================
   POLAROID (‡πÄ‡∏î‡∏¥‡∏°)
================================================= */
function makeFinal(){
  show('result');
  fctx.fillStyle='white';
  fctx.fillRect(0,0,420,1100);

  fctx.font='26px Gaegu';
  fctx.textAlign='center';
  fctx.fillStyle='#000';
  fctx.fillText('SENAPHOTOBOOTH',210,60);

  let y=100;
  shots.forEach(s=>{
    drawCover(fctx,s,40,y,340,240);
    y+=270;
  });

  fctx.fillText('‚≠ê ‚úø ‚òÖ ‚ò∫Ô∏é',210,1050);
}

/* =================================================
   UTIL ‚Äì CENTER CROP (‡πÄ‡∏î‡∏¥‡∏°)
================================================= */
function drawCover(ctx,img,x,y,w,h){
  const ir=img.width/img.height;
  const tr=w/h;
  let sx,sy,sw,sh;
  if(ir>tr){
    sh=img.height;
    sw=sh*tr;
    sx=(img.width-sw)/2; sy=0;
  }else{
    sw=img.width;
    sh=sw/tr;
    sx=0; sy=(img.height-sh)/2;
  }
  ctx.drawImage(img,sx,sy,sw,sh,x,y,w,h);
}

/* =================================================
   AUDIO (‡πÄ‡∏û‡∏¥‡πà‡∏°)
================================================= */
function playShutter(){
  const a=new AudioContext();
  const n=a.createBufferSource();
  const b=a.createBuffer(1,44100,44100);
  const d=b.getChannelData(0);
  for(let i=0;i<d.length;i++) d[i]=Math.random()*2-1;
  n.buffer=b;
  n.connect(a.destination);
  n.start();
}
function beep(){
  const a=new AudioContext();
  const o=a.createOscillator();
  o.frequency.value=700;
  o.connect(a.destination);
  o.start();
  o.stop(a.currentTime+0.05);
}

/* =================================================
   ACTIONS (‡πÄ‡∏î‡∏¥‡∏°)
================================================= */
function download(){
  const a=document.createElement('a');
  a.href=final.toDataURL('image/png');
  a.download='SENA_PHOTOBOOTH.png';
  a.click();
}
function reset(){ show('start'); }
</script>

</body>
</html>
