<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>SENA PHOTOBOOTH</title>

<!-- ================= FONT ================= -->
<link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">

<style>
/* =====================================================
   GLOBAL THEME ‚Äì Korean DIY / Hand-Drawn
===================================================== */
:root{
  --cream:#FFF6D8;
  --yellow:#FFE9A8;
  --pastel-blue:#EAF2FF;
  --ink:#1E2A44;
  --line:#2A3553;
}

*{box-sizing:border-box;}

body{
  margin:0;
  height:100vh;
  font-family:'Patrick Hand', cursive;
  background:var(--cream);
  color:var(--ink);
  display:flex;
  justify-content:center;
  align-items:center;
  user-select:none;
}

/* =====================================================
   SCREEN SYSTEM
===================================================== */
.screen{
  display:none;
  width:100%;
  height:100%;
}
.screen.active{display:flex;}

.app{
  width:100%;
  height:100%;
  padding:20px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
}

/* =====================================================
   DOODLE ELEMENTS
===================================================== */
.star{
  width:18px;height:18px;
  background:transparent;
  position:relative;
}
.star:before,
.star:after{
  content:'';
  position:absolute;
  inset:0;
  background:var(--ink);
  transform:rotate(45deg);
}
.star:after{transform:rotate(-45deg);}

.doodle{
  position:absolute;
  font-size:18px;
  opacity:.6;
}

/* =====================================================
   START SCREEN
===================================================== */
#start h1{
  font-size:42px;
  letter-spacing:2px;
  margin-bottom:12px;
}

#start p{
  font-size:20px;
  margin-bottom:30px;
}

.start-btn{
  width:160px;
  height:160px;
  border-radius:50%;
  background:var(--pastel-blue);
  border:4px solid var(--line);
  font-size:22px;
  display:flex;
  align-items:center;
  justify-content:center;
}

/* =====================================================
   BOOTH LAYOUT
===================================================== */
.booth{
  flex:1;
  width:100%;
  display:flex;
  gap:20px;
}

/* CAMERA */
.camera-box{
  flex:1.4;
  background:var(--pastel-blue);
  border:4px solid var(--line);
  border-radius:28px;
  padding:14px;
  position:relative;
}

.camera-frame{
  width:100%;
  height:100%;
  border:4px dashed var(--line);
  border-radius:22px;
  overflow:hidden;
}

video{
  width:100%;
  height:100%;
  object-fit:cover;
}

/* COUNTDOWN */
#countdown{
  position:absolute;
  inset:0;
  display:none;
  justify-content:center;
  align-items:center;
  font-size:96px;
  color:white;
  text-shadow:4px 4px var(--ink);
}

/* PREVIEW STRIP */
.preview{
  flex:.6;
  display:flex;
  flex-direction:column;
  gap:14px;
}

.preview canvas{
  background:white;
  border:3px solid var(--line);
  border-radius:14px;
  height:30%;
}

/* =====================================================
   CONTROLS
===================================================== */
.controls{
  margin-top:14px;
  display:flex;
  gap:14px;
  align-items:center;
}

.btn{
  padding:14px 22px;
  border-radius:20px;
  border:3px solid var(--line);
  background:var(--yellow);
  font-size:18px;
}

.btn.circle{
  width:80px;height:80px;
  border-radius:50%;
  font-size:28px;
  background:white;
}

/* =====================================================
   RESULT POLAROID
===================================================== */
#result canvas{
  background:white;
  border:4px solid var(--line);
  border-radius:20px;
}

.result-actions{
  display:flex;
  gap:14px;
  margin-top:16px;
}

/* =====================================================
   HAND DRAWN FEEL
===================================================== */
.btn, .camera-box, .preview canvas{
  transform:rotate(-.5deg);
}
</style>
</head>

<body>

<!-- ================= START SCREEN ================= -->
<div id="start" class="screen active app">
  <div class="star"></div>
  <h1>SENA PHOTOBOOTH</h1>
  <p>‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ñ‡πà‡∏≤‡∏¢ üì∏</p>
  <div class="start-btn" onclick="startBooth()">START</div>
</div>

<!-- ================= BOOTH ================= -->
<div id="booth" class="screen app">
  <div class="booth">

    <div class="camera-box">
      <div class="camera-frame">
        <video id="video" autoplay playsinline></video>
      </div>
      <div id="countdown">3</div>
    </div>

    <div class="preview">
      <canvas width="240" height="320"></canvas>
      <canvas width="240" height="320"></canvas>
      <canvas width="240" height="320"></canvas>
    </div>
  </div>

  <div class="controls">
    <div class="btn" onclick="toggleMode()">MODE: <span id="modeText">COLOR</span></div>
    <div class="btn circle" onclick="startShoot()">‚óè</div>
    <div class="btn" onclick="resetAll()">RESET</div>
  </div>
</div>

<!-- ================= RESULT ================= -->
<div id="result" class="screen app">
  <canvas id="polaroid" width="420" height="1100"></canvas>
  <div class="result-actions">
    <div class="btn" onclick="download()">DOWNLOAD</div>
    <div class="btn" onclick="resetAll()">FINISH</div>
  </div>
</div>

<script>
/* =====================================================
   STATE
===================================================== */
const video=document.getElementById('video');
const previews=document.querySelectorAll('.preview canvas');
const cd=document.getElementById('countdown');
const polaroid=document.getElementById('polaroid');
const pctx=polaroid.getContext('2d');

let shots=[];
let mode='color';

/* =====================================================
   CAMERA
===================================================== */
function startBooth(){
  show('booth');
  navigator.mediaDevices.getUserMedia({video:{facingMode:'user'}})
    .then(s=>video.srcObject=s);
}

/* =====================================================
   UI FLOW
===================================================== */
function show(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

/* =====================================================
   SHOOT FLOW
===================================================== */
function startShoot(){
  shots=[];
  previews.forEach(c=>c.getContext('2d').clearRect(0,0,c.width,c.height));
  shoot(0);
}

function shoot(i){
  if(i>=3){ makePolaroid(); return; }

  let n=3;
  cd.style.display='flex';
  cd.textContent=n;

  const t=setInterval(()=>{
    n--;
    cd.textContent=n;
    if(n===0){
      clearInterval(t);
      cd.style.display='none';
      capture(i);
      setTimeout(()=>shoot(i+1),500);
    }
  },1000);
}

function capture(i){
  playShutter();
  const temp=document.createElement('canvas');
  temp.width=video.videoWidth;
  temp.height=video.videoHeight;
  temp.getContext('2d').drawImage(video,0,0);

  shots.push(temp);

  const ctx=previews[i].getContext('2d');
  drawCover(ctx,temp,0,0,previews[i].width,previews[i].height);
}

/* =====================================================
   POLAROID
===================================================== */
function makePolaroid(){
  show('result');
  pctx.fillStyle='white';
  pctx.fillRect(0,0,420,1100);

  pctx.fillStyle='#000';
  pctx.font='24px Patrick Hand';
  pctx.textAlign='center';
  pctx.fillText('SENAPHOTOBOOTH',210,60);

  let y=100;
  shots.forEach(s=>{
    drawCover(pctx,s,40,y,340,240);
    y+=270;
  });

  pctx.fillText('‚≠ê ‚òÖ ‚úø',210,1040);
}

/* =====================================================
   UTIL ‚Äì COVER (NO STRETCH)
===================================================== */
function drawCover(ctx,img,x,y,w,h){
  const ir=img.width/img.height;
  const tr=w/h;
  let sx,sy,sw,sh;
  if(ir>tr){
    sh=img.height;
    sw=sh*tr;
    sx=(img.width-sw)/2;
    sy=0;
  }else{
    sw=img.width;
    sh=sw/tr;
    sx=0;
    sy=(img.height-sh)/2;
  }
  ctx.drawImage(img,sx,sy,sw,sh,x,y,w,h);
}

/* =====================================================
   MODE
===================================================== */
function toggleMode(){
  mode = mode==='color'?'mono':'color';
  document.getElementById('modeText').textContent=mode.toUpperCase();
  video.style.filter = mode==='mono'?'grayscale(1)':'none';
}

/* =====================================================
   AUDIO
===================================================== */
function playShutter(){
  const ctx=new AudioContext();
  const o=ctx.createOscillator();
  const g=ctx.createGain();
  o.type='square';
  o.frequency.value=800;
  o.connect(g);
  g.connect(ctx.destination);
  o.start();
  g.gain.exponentialRampToValueAtTime(0.0001,ctx.currentTime+.15);
}

/* =====================================================
   RESET / DOWNLOAD
===================================================== */
function resetAll(){show('start');}

function download(){
  const a=document.createElement('a');
  a.download='SENA_PHOTOBOOTH.png';
  a.href=polaroid.toDataURL('image/png');
  a.click();
}
</script>
</body>
</html>
