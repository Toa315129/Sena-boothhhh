<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>SENA PHOTOBOOTH</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --white:#ffffff;
  --cream:#fffaf2;
  --blue:#e9f2ff;
  --blue-dark:#7aa7e9;
  --text:#1f2a44;
}

*{box-sizing:border-box;}

body{
  margin:0;
  font-family:'Helvetica Neue', Arial, sans-serif;
  background:var(--cream);
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  color:var(--text);
}

.screen{
  display:none;
  flex-direction:column;
  align-items:center;
  text-align:center;
}
.active{display:flex;}

h1{
  letter-spacing:3px;
  font-weight:600;
  margin-bottom:20px;
}

button{
  padding:16px 44px;
  font-size:18px;
  border-radius:999px;
  border:none;
  background:var(--white);
  box-shadow:0 6px 18px rgba(0,0,0,.08);
}

.primary{
  background:var(--blue-dark);
  color:white;
}

.star{
  position:fixed;
  color:#b7ccf5;
  font-size:14px;
}
.star:nth-child(1){top:40px;left:60px;}
.star:nth-child(2){top:90px;right:80px;}
.star:nth-child(3){bottom:80px;left:100px;}
.star:nth-child(4){bottom:140px;right:120px;}

/* ---------- CAMERA ---------- */
.camera{
  width:360px;
  height:480px;
  background:var(--blue);
  border-radius:180px 180px 28px 28px;
  padding:18px;
  box-shadow:0 20px 40px rgba(0,0,0,.15);
  position:relative;
}

video{
  width:100%;
  height:100%;
  object-fit:cover;
  border-radius:160px 160px 22px 22px;
}

#countdown{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  font-size:96px;
  color:white;
  display:none;
}

#progressText{
  position:absolute;
  bottom:78px;
  width:100%;
  text-align:center;
  color:white;
  font-size:16px;
  letter-spacing:2px;
}

#dots{
  position:absolute;
  bottom:46px;
  width:100%;
  display:flex;
  justify-content:center;
  gap:12px;
}
#dots span{
  width:14px;
  height:14px;
  border-radius:50%;
  background:rgba(255,255,255,.4);
}
#dots span.active{
  background:white;
}

/* ---------- RESULT ---------- */
#final{
  background:white;
  border-radius:24px;
  box-shadow:0 20px 40px rgba(0,0,0,.25);
}
.caption{
  margin:10px 0 20px;
  font-size:12px;
  letter-spacing:3px;
}
</style>
</head>

<body>

<div class="star">✦</div>
<div class="star">✦</div>
<div class="star">✦</div>
<div class="star">✦</div>

<!-- หน้าแรก -->
<div id="home" class="screen active">
  <h1>SENA PHOTOBOOTH</h1>
  <button onclick="selectMode('color')">COLOR</button>
  <button onclick="selectMode('mono')">MONO</button>
</div>

<!-- หน้าถ่าย -->
<div id="booth" class="screen">
  <h1>READY</h1>
  <div class="camera">
    <video id="video" autoplay playsinline></video>
    <div id="countdown">3</div>
    <div id="progressText">0 / 4</div>
    <div id="dots">
      <span></span><span></span><span></span><span></span>
    </div>
  </div>
  <button class="primary" onclick="startSession()">TAKE PHOTO</button>
</div>

<!-- หน้าผลลัพธ์ -->
<div id="result" class="screen">
  <h1>YOUR PHOTO</h1>
  <canvas id="final" width="600" height="1600"></canvas>
  <div class="caption">SENA PHOTOBOOTH</div>
  <button class="primary" onclick="download()">DOWNLOAD</button>
  <button onclick="reset()">FINISH</button>
</div>

<script>
let mode="color";
let shots=[];
let shotIndex=0;

const video=document.getElementById("video");
const cd=document.getElementById("countdown");
const final=document.getElementById("final");
const fctx=final.getContext("2d");
const progressText=document.getElementById("progressText");
const dots=document.querySelectorAll("#dots span");

function show(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function selectMode(m){
  mode=m;
  show('booth');
  navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}})
    .then(s=>video.srcObject=s);
}

function startSession(){
  shots=[];
  shotIndex=0;
  updateProgress();
  takeNext();
}

function takeNext(){
  if(shotIndex>=4){
    makeStrip();
    return;
  }
  let c=3;
  cd.style.display="block";
  cd.innerText=c;

  let timer=setInterval(()=>{
    c--;
    cd.innerText=c;
    if(c===0){
      clearInterval(timer);
      cd.style.display="none";
      capture();
    }
  },1000);
}

function capture(){
  const temp=document.createElement("canvas");
  temp.width=video.videoWidth;
  temp.height=video.videoHeight;
  const tctx=temp.getContext("2d");
  tctx.drawImage(video,0,0);

  let img=tctx.getImageData(0,0,temp.width,temp.height);
  for(let i=0;i<img.data.length;i+=4){
    img.data[i]+=10;
    img.data[i+1]+=10;
    img.data[i+2]+=10;
    if(mode==="mono"){
      let a=(img.data[i]+img.data[i+1]+img.data[i+2])/3;
      img.data[i]=img.data[i+1]=img.data[i+2]=a;
    }
  }
  tctx.putImageData(img,0,0);

  shots.push(temp);
  shotIndex++;
  updateProgress();
  setTimeout(takeNext,500);
}

function updateProgress(){
  progressText.innerText = `${shotIndex} / 4`;
  dots.forEach((d,i)=>d.classList.toggle("active", i < shotIndex));
}

function makeStrip(){
  show('result');
  fctx.fillStyle="#fff";
  fctx.fillRect(0,0,600,1600);

  let y=80;
  shots.forEach(s=>{
    fctx.fillStyle="rgba(0,0,0,.08)";
    fctx.fillRect(80,y+12,440,300);
    fctx.drawImage(s,60,y,480,300);
    y+=340;
  });

  fctx.fillStyle="#000";
  fctx.font="22px Arial";
  fctx.textAlign="center";
  fctx.fillText("SENA PHOTOBOOTH",300,1520);
}

function download(){
  const a=document.createElement("a");
  a.download="SENA_PHOTOBOOTH.png";
  a.href=final.toDataURL("image/png");
  a.click();
}

function reset(){
  show('home');
}
</script>

</body>
</html>
