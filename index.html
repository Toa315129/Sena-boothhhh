<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>SENA PHOTOBOOTH</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;}

body{
    margin:0;
    font-family: 'Helvetica Neue', Arial, sans-serif;
    background: linear-gradient(135deg,#f7fbff,#eef5ff);
    height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    color:#222;
}

/* ---------- GLOBAL ---------- */
.screen{
    display:none;
    flex-direction:column;
    align-items:center;
    text-align:center;
}
.active{display:flex;}

h1{
    letter-spacing:4px;
    font-weight:500;
    margin-bottom:20px;
}

button{
    padding:14px 40px;
    margin:10px;
    font-size:18px;
    border-radius:14px;
    border:1px solid #cfdfff;
    background:white;
    cursor:pointer;
}

.primary{
    background:#6fa8ff;
    color:white;
    border:none;
}

/* ---------- CAMERA ---------- */
.camera{
    width:320px;
    aspect-ratio:3/4;
    background:black;
    border-radius:20px;
    overflow:hidden;
    position:relative;
    box-shadow:0 12px 30px rgba(0,0,0,.2);
}

video,canvas{
    width:100%;
    height:100%;
    object-fit:cover;
}

#countdown{
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    font-size:90px;
    color:white;
    display:none;
}

/* ---------- RESULT ---------- */
#final{
    background:white;
    border-radius:20px;
    box-shadow:0 15px 40px rgba(0,0,0,.25);
}
.caption{
    margin-top:10px;
    font-size:12px;
    letter-spacing:2px;
    color:#555;
}
</style>
</head>

<body>

<!-- หน้าแรก -->
<div id="home" class="screen active">
    <h1>SENA PHOTOBOOTH</h1>
    <button onclick="selectMode('color')">COLOR</button>
    <button onclick="selectMode('mono')">MONO</button>
</div>

<!-- หน้าถ่าย -->
<div id="booth" class="screen">
    <h1>READY</h1>
    <div class="camera">
        <video id="video" autoplay playsinline></video>
        <div id="countdown">3</div>
    </div>
    <button class="primary" onclick="startSession()">TAKE PHOTO</button>
</div>

<!-- หน้าผลลัพธ์ -->
<div id="result" class="screen">
    <h1>YOUR PHOTO</h1>
    <canvas id="final" width="600" height="1600"></canvas>
    <div class="caption">SENA PHOTOBOOTH</div>
    <button class="primary" onclick="download()">DOWNLOAD</button>
    <button onclick="reset()">FINISH</button>
</div>

<script>
let mode="color";
let shots=[];
let shotIndex=0;

const video=document.getElementById("video");
const cd=document.getElementById("countdown");
const final=document.getElementById("final");
const fctx=final.getContext("2d");

function show(id){
    document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
}

function selectMode(m){
    mode=m;
    show('booth');
    navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}})
    .then(s=>video.srcObject=s);
}

function startSession(){
    shots=[];
    shotIndex=0;
    takeNext();
}

function takeNext(){
    if(shotIndex>=4){
        makeStrip();
        return;
    }
    let c=3;
    cd.style.display="block";
    cd.innerText=c;

    let timer=setInterval(()=>{
        c--;
        cd.innerText=c;
        if(c===0){
            clearInterval(timer);
            cd.style.display="none";
            capture();
        }
    },1000);
}

function capture(){
    const temp=document.createElement("canvas");
    temp.width=video.videoWidth;
    temp.height=video.videoHeight;
    const tctx=temp.getContext("2d");
    tctx.drawImage(video,0,0);

    // ฟิลเตอร์โพลารอยด์นุ่ม ๆ
    let img=tctx.getImageData(0,0,temp.width,temp.height);
    for(let i=0;i<img.data.length;i+=4){
        img.data[i]+=10;     // warm
        img.data[i+1]+=10;
        img.data[i+2]+=10;
        if(mode==="mono"){
            let a=(img.data[i]+img.data[i+1]+img.data[i+2])/3;
            img.data[i]=img.data[i+1]=img.data[i+2]=a;
        }
    }
    tctx.putImageData(img,0,0);

    shots.push(temp);
    shotIndex++;
    setTimeout(takeNext,500);
}

function makeStrip(){
    show('result');
    fctx.fillStyle="#ffffff";
    fctx.fillRect(0,0,600,1600);

    let y=80;
    shots.forEach(s=>{
        fctx.drawImage(s,60,y,480,300);
        y+=360;
    });

    fctx.fillStyle="#000";
    fctx.font="24px Arial";
    fctx.textAlign="center";
    fctx.fillText("SENA PHOTOBOOTH",300,1540);
}

function download(){
    const a=document.createElement("a");
    a.download="SENA_PHOTOBOOTH.png";
    a.href=final.toDataURL("image/png");
    a.click();
}

function reset(){
    show('home');
}
</script>

</body>
</html>
