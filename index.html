<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>SENAPHOTOBOOTH | The Ultimate Experience</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/Draggable.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,900;1,900&family=Caveat:wght@700&family=Space+Grotesk:wght@300;700&display=swap" rel="stylesheet">

    <style>
        /* --- THEME ENGINE --- */
        :root {
            --bg-sky: #7dd3fc;
            --sd-body: #1c1c1e;
            --sd-pin: linear-gradient(180deg, #fbbf24 0%, #b45309 100%);
            --accent: #6366f1;
            --ipad-width: 2360px; /* Reference iPad Gen 11 */
            --ipad-height: 1640px;
        }

        * { 
            margin: 0; padding: 0; box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: #000;
            font-family: 'Space Grotesk', sans-serif;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            color: white;
        }

        /* --- BACKGROUND LAYER --- */
        .world-container {
            position: fixed;
            inset: 0;
            background: var(--bg-sky);
            background-image: 
                radial-gradient(at 0% 0%, hsla(199,89%,48%,1) 0, transparent 50%), 
                radial-gradient(at 100% 100%, hsla(180,100%,80%,1) 0, transparent 50%);
            z-index: 1;
        }

        /* --- SD CARD UI SCULPTING --- */
        .booth-interface {
            position: relative;
            z-index: 10;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: env(safe-area-inset-top) 40px env(safe-area-inset-bottom);
        }

        .sd-card-outer {
            position: relative;
            width: 90%;
            max-width: 1000px;
            aspect-ratio: 4/3;
            background: var(--sd-body);
            border-radius: 50px;
            box-shadow: 
                0 0 0 10px rgba(0,0,0,0.1),
                0 40px 100px -20px rgba(0,0,0,0.6);
            display: flex;
            flex-direction: column;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.05);
        }

        /* ขา Pin สีทองตามแบบ */
        .sd-pins-header {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            opacity: 0.6;
        }

        .pin {
            width: 35px;
            height: 70px;
            background: var(--sd-pin);
            border-radius: 0 0 8px 8px;
            box-shadow: inset 0 -4px 10px rgba(0,0,0,0.4);
        }

        /* --- DISPLAY ENGINE --- */
        .viewport-container {
            flex: 1;
            background: #080808;
            border-radius: 35px;
            overflow: hidden;
            position: relative;
            border: 4px solid #2c2c2e;
        }

        #camera-feed {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1); /* Mirror for user-facing camera */
        }

        /* Grain Overlay */
        .noise-overlay {
            position: absolute;
            inset: 0;
            background: url('https://grainy-gradients.vercel.app/noise.svg');
            opacity: 0.08;
            pointer-events: none;
            z-index: 5;
        }

        /* --- TYPOGRAPHY --- */
        .brand-logo {
            position: absolute;
            top: -80px;
            left: 0;
            font-family: 'Montserrat', sans-serif;
            font-size: 42px;
            font-weight: 900;
            font-style: italic;
            letter-spacing: -3px;
            color: #000;
        }

        .handwriting-effect {
            font-family: 'Caveat', cursive;
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 80px;
            line-height: 1;
            color: white;
            text-shadow: 0 10px 30px rgba(0,0,0,0.5);
            opacity: 0;
            z-index: 20;
        }

        /* --- CONTROL SYSTEMS --- */
        .controls-layer {
            margin-top: 40px;
            display: flex;
            align-items: center;
            gap: 50px;
        }

        .shutter-trigger {
            width: 120px;
            height: 120px;
            background: white;
            border-radius: 50%;
            padding: 10px;
            cursor: pointer;
            transition: 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .shutter-inner {
            width: 100%;
            height: 100%;
            background: #ff3b30;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.2);
        }

        .action-button {
            width: 80px;
            height: 80px;
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(255,255,255,0.3);
            transition: all 0.3s ease;
        }

        .action-button:active { transform: scale(0.9); }

        /* --- ANIMATION STATES --- */
        .flash-active {
            position: fixed;
            inset: 0;
            background: white;
            z-index: 999;
            pointer-events: none;
            opacity: 0;
        }

        #countdown-ui {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 300px;
            font-weight: 900;
            color: white;
            z-index: 30;
            pointer-events: none;
            -webkit-text-stroke: 4px black;
        }
    </style>
</head>
<body>

    <div class="world-container"></div>
    <div class="flash-active" id="flash"></div>

    <div class="booth-interface">
        
        <div class="sd-card-outer">
            <div class="brand-logo">SENA<span style="color:white; -webkit-text-stroke: 1.5px black;">PHOTOBOOTH</span></div>
            
            <div class="sd-pins-header">
                <div class="pin"></div><div class="pin"></div><div class="pin"></div>
                <div class="pin"></div><div class="pin"></div><div class="pin"></div>
                <div class="pin"></div><div class="pin"></div>
            </div>

            <div class="viewport-container">
                <div class="noise-overlay"></div>
                <video id="camera-feed" autoplay playsinline></video>
                <canvas id="capture-buffer" style="display:none;"></canvas>
                
                <div id="countdown-ui"></div>
                
                <div class="handwriting-effect" id="result-text">
                    Taking a picture of <br> all the people <br> close to us
                </div>
                
                <div id="capture-preview" class="absolute inset-0 z-10 hidden">
                    <img id="final-img" class="w-full h-full object-cover">
                </div>

                <div class="absolute bottom-4 right-6 text-white/30 text-[10px] tracking-widest uppercase font-bold">
                    Memory Format 1.0 // SENA-PB
                </div>
            </div>
        </div>

        <div class="controls-layer">
            <button class="action-button" id="btn-reset" style="opacity:0;">
                <i data-lucide="refresh-ccw" color="white"></i>
            </button>

            <div class="shutter-trigger" id="shutter">
                <div class="shutter-inner">
                    <i data-lucide="camera" color="white" size="32"></i>
                </div>
            </div>

            <button class="action-button" id="btn-save" style="opacity:0;">
                <i data-lucide="download" color="white"></i>
            </button>
        </div>
    </div>

    <script>
        /**
         * SENAPHOTOBOOTH CORE ENGINE
         * Version: 2.0.0
         * Designed for High-Performance iPad Booths
         */

        const config = {
            countdown: 3,
            filter: {
                brightness: 1.1,
                contrast: 1.2,
                saturate: 1.1
            }
        };

        const state = {
            isProcessing: false,
            stream: null
        };

        const elements = {
            video: document.getElementById('camera-feed'),
            shutter: document.getElementById('shutter'),
            countdown: document.getElementById('countdown-ui'),
            flash: document.getElementById('flash'),
            buffer: document.getElementById('capture-buffer'),
            preview: document.getElementById('capture-preview'),
            finalImg: document.getElementById('final-img'),
            resultText: document.getElementById('result-text'),
            btnReset: document.getElementById('btn-reset'),
            btnSave: document.getElementById('btn-save')
        };

        // Initialize Icons
        lucide.createIcons();

        // 1. Camera System
        async function startCamera() {
            try {
                state.stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        facingMode: 'user',
                        width: { ideal: 1920 },
                        height: { ideal: 1440 }
                    }
                });
                elements.video.srcObject = state.stream;
            } catch (err) {
                console.error("Camera System Error:", err);
                alert("ระบบกล้องขัดข้อง: กรุณาให้สิทธิ์การเข้าถึงกล้อง");
            }
        }

        // 2. The Capture Logic
        function takePhoto() {
            if (state.isProcessing) return;
            state.isProcessing = true;

            let timer = config.countdown;
            gsap.to(elements.shutter, { scale: 0.8, opacity: 0.5 });

            const interval = setInterval(() => {
                elements.countdown.innerText = timer;
                gsap.fromTo(elements.countdown, { scale: 1.5, opacity: 0 }, { scale: 1, opacity: 1, duration: 0.4 });
                
                timer--;
                if (timer < 0) {
                    clearInterval(interval);
                    elements.countdown.innerText = "";
                    executeCapture();
                }
            }, 1000);
        }

        function executeCapture() {
            // Flash Effect Animation
            gsap.to(elements.flash, { 
                opacity: 1, 
                duration: 0.05, 
                onComplete: () => {
                    renderImage();
                    gsap.to(elements.flash, { opacity: 0, duration: 0.5 });
                }
            });
        }

        // 3. Image Processing Engine
        function renderImage() {
            const ctx = elements.buffer.getContext('2d');
            elements.buffer.width = elements.video.videoWidth;
            elements.buffer.height = elements.video.videoHeight;

            // Apply Vintage Digital Filter
            ctx.filter = `brightness(${config.filter.brightness}) contrast(${config.filter.contrast}) saturate(${config.filter.saturate})`;
            
            // Draw Mirror Image
            ctx.translate(elements.buffer.width, 0);
            ctx.scale(-1, 1);
            ctx.drawImage(elements.video, 0, 0);

            const imageData = elements.buffer.toDataURL('image/jpeg', 0.95);
            elements.finalImg.src = imageData;
            
            // Transition to Preview
            elements.preview.classList.remove('hidden');
            gsap.fromTo(elements.preview, { opacity: 0 }, { opacity: 1, duration: 0.8 });
            
            // Show Handwriting Text
            gsap.fromTo(elements.resultText, 
                { opacity: 0, y: 30 }, 
                { opacity: 1, y: 0, duration: 1.5, delay: 0.5, ease: "power2.out" }
            );

            // Show UI Controls
            gsap.to([elements.btnReset, elements.btnSave], { opacity: 1, y: -10, stagger: 0.1 });
            gsap.to(elements.shutter, { display: 'none' });
        }

        // 4. UI Actions
        elements.shutter.addEventListener('click', takePhoto);

        elements.btnReset.addEventListener('click', () => {
            state.isProcessing = false;
            elements.preview.classList.add('hidden');
            elements.resultText.style.opacity = 0;
            gsap.to(elements.shutter, { display: 'block', scale: 1, opacity: 1 });
            gsap.to([elements.btnReset, elements.btnSave], { opacity: 0, y: 10 });
        });

        elements.btnSave.addEventListener('click', () => {
            const link = document.createElement('a');
            link.download = `SENAPB_${Date.now()}.jpg`;
            link.href = elements.finalImg.src;
            link.click();
        });

        // Start Application
        window.addEventListener('load', startCamera);

    </script>
</body>
</html>
