<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SENA PHOTOBOOTH | Cute Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">
    <style>
        :root {
            /* ‡∏ä‡∏∏‡∏î‡∏™‡∏µ‡πÉ‡∏´‡∏°‡πà ‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å ‡∏û‡∏≤‡∏™‡πÄ‡∏ó‡∏• */
            --bg-color: #FFF9E6; /* ‡∏™‡∏µ‡∏Ñ‡∏£‡∏µ‡∏°‡πÑ‡∏Ç‡πà‡πÑ‡∏Å‡πà */
            --booth-bg: #FFFAE1;
            --text-color: #4A4A4A; /* ‡∏™‡∏µ‡∏î‡∏≥‡∏ã‡∏≠‡∏ü‡∏ï‡πå‡πÜ */
            --accent-color: #FF9FAC; /* ‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π‡∏û‡∏≤‡∏™‡πÄ‡∏ó‡∏• */
            --accent-color-2: #7EC8E3; /* ‡∏™‡∏µ‡∏ü‡πâ‡∏≤‡∏û‡∏≤‡∏™‡πÄ‡∏ó‡∏• */
            --border-color: #4A4A4A;
            --shadow-hard: 6px 6px 0px rgba(0,0,0,0.15);
            --font-cute: 'Patrick Hand', cursive;
        }

        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        
        body {
            margin: 0;
            font-family: var(--font-cute);
            background-color: var(--bg-color);
            color: var(--text-color);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            background-image: radial-gradient(#E6E1CF 1px, transparent 1px);
            background-size: 20px 20px; /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏•‡∏≤‡∏¢‡∏à‡∏∏‡∏î‡πÄ‡∏•‡πá‡∏Å‡πÜ */
        }

        /* --- ‡∏ï‡∏±‡∏ß‡∏ï‡∏π‡πâ (The Booth Case) --- */
        .app-container {
            width: 100%;
            max-width: 460px;
            height: 100%;
            background: var(--booth-bg);
            position: relative;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border: 4px solid var(--border-color); /* ‡∏Ç‡∏≠‡∏ö‡∏´‡∏ô‡∏≤‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏ß‡∏≤‡∏î */
        }

        @media (min-width: 500px) {
            .app-container { 
                height: 92vh; 
                border-radius: 35px; /* ‡∏°‡∏∏‡∏°‡πÇ‡∏Ñ‡πâ‡∏á‡∏°‡∏ô */
                box-shadow: var(--shadow-hard);
            }
        }

        /* Deco elements (‡∏•‡∏ß‡∏î‡∏•‡∏≤‡∏¢‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á) */
        .deco { position: absolute; font-weight: bold; pointer-events: none; z-index: 0; }
        .d-star1 { top: 20px; left: 20px; color: var(--accent-color); font-size: 2rem; transform: rotate(-15deg); }
        .d-star2 { bottom: 30px; right: 20px; color: var(--accent-color-2); font-size: 2.5rem; transform: rotate(10deg); }
        .d-line1 { top: 120px; right: -10px; color: var(--border-color); font-size: 1.5rem; }
        .d-line2 { bottom: 100px; left: -10px; color: var(--border-color); font-size: 1.5rem; }

        .screen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: transparent;
            transition: opacity 0.4s ease, transform 0.4s ease;
            opacity: 0; pointer-events: none; padding: 30px; z-index: 2;
        }

        .screen.active { opacity: 1; pointer-events: all; transform: scale(1); }

        /* --- Screen 1: Home --- */
        .brand-logo {
            font-size: 2.8rem; letter-spacing: 1px; margin-bottom: 5px;
            text-transform: uppercase; text-align: center;
            text-shadow: 3px 3px 0px #fff, 5px 5px 0px var(--border-color);
        }
        .brand-sub { font-size: 1.2rem; margin-bottom: 40px; color: var(--accent-color-2); font-weight: bold; }

        .control-group { width: 100%; margin-bottom: 25px; background: #fff; padding: 20px; border-radius: 25px; border: 3px solid var(--border-color); box-shadow: var(--shadow-hard); }
        .label { font-size: 1.1rem; font-weight: bold; margin-bottom: 15px; display: block; text-align: center; }

        /* Color Picker Cute Style */
        .color-row { display: flex; gap: 15px; justify-content: center; }
        .c-btn {
            width: 45px; height: 45px; border-radius: 50%; 
            border: 3px solid var(--border-color); cursor: pointer;
            transition: transform 0.2s; box-shadow: 2px 2px 0px rgba(0,0,0,0.1);
        }
        .c-btn.active { transform: scale(1.1) translate(-2px, -2px); box-shadow: 4px 4px 0px var(--border-color); }

        /* Filter Switch Cute Style */
        .mode-switch {
            display: flex; background: var(--border-color); border-radius: 30px; padding: 4px;
            position: relative; width: 220px; margin: 0 auto; border: 3px solid var(--border-color);
        }
        .mode-bg {
            position: absolute; top:4px; left:4px; width: calc(50% - 4px); height: calc(100% - 8px);
            background: #fff; border-radius: 25px; transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            border: 2px solid var(--border-color);
        }
        .m-btn {
            flex: 1; border: none; background: transparent; padding: 8px; font-size: 1.1rem; color: #fff;
            font-family: var(--font-cute); cursor: pointer; z-index: 2; transition: color 0.3s;
        }
        .m-btn.active-text { color: var(--border-color); }

        .big-btn {
            background: var(--accent-color); color: #fff; border: 3px solid var(--border-color); 
            padding: 15px 0; width: 100%; border-radius: 30px; font-size: 1.5rem; 
            font-family: var(--font-cute); cursor: pointer;
            box-shadow: var(--shadow-hard); transition: all 0.2s; margin-top: 15px;
            text-shadow: 2px 2px 0px var(--border-color);
        }
        .big-btn:active { transform: translate(4px, 4px); box-shadow: none; }
        .big-btn.secondary { background: #fff; color: var(--text-color); }

        /* --- Screen 2: Capture --- */
        .camera-frame {
            width: 100%; aspect-ratio: 3/4; background: #000; border-radius: 25px;
            overflow: hidden; position: relative; 
            border: 5px solid #fff; outline: 3px solid var(--border-color);
            box-shadow: var(--shadow-hard);
        }
        video { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); }
        .countdown-big {
            position: absolute; top:50%; left:50%; transform:translate(-50%,-50%);
            font-size: 7rem; color: #fff; text-shadow: 4px 4px 0px var(--border-color); display: none;
        }
        .strip-preview {
            display: flex; gap: 10px; margin-top: 25px; width: 100%; justify-content: center;
        }
        .mini-shot {
            width: 55px; height: 72px; background: #eee; border-radius: 10px; overflow: hidden;
            border: 3px solid #fff; outline: 2px solid var(--border-color);
            box-shadow: 3px 3px 0px rgba(0,0,0,0.1); opacity: 0.4; transition: all 0.3s; transform: rotate(-2deg);
        }
        .mini-shot:nth-child(2) { transform: rotate(2deg); }
        .mini-shot.taken { opacity: 1; transform: rotate(0deg) scale(1.1); z-index: 2; }
        .mini-shot img { width: 100%; height: 100%; object-fit: cover; }

        /* --- Screen 3: Result --- */
        .paper-strip {
            width: auto; height: 58vh; 
            box-shadow: 10px 10px 0px rgba(0,0,0,0.1);
            border: 4px solid var(--border-color); border-radius: 15px;
            transform: translateY(50px) rotate(-2deg); opacity: 0; transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .paper-strip.show { transform: translateY(0) rotate(0deg); opacity: 1; }
        .flash { position: fixed; top:0; left:0; width:100%; height:100%; background: #fff; opacity: 0; pointer-events: none; z-index: 99; transition: opacity 0.1s; }
    </style>
</head>
<body>

    <div class="app-container">
        <div class="deco d-star1">*</div>
        <div class="deco d-star2">*</div>
        <div class="deco d-line1">~</div>
        <div class="deco d-line2">~</div>

        <div id="screen-home" class="screen active">
            <div class="brand-logo">SENA<br>PHOTOBOOTH</div>
            <div class="brand-sub">Cute & Cozy Edition</div>

            <div class="control-group">
                <label class="label">‚ú® Pick Your Frame Color ‚ú®</label>
                <div class="color-row">
                    <button class="c-btn active" style="background:#fff;" onclick="setFrame('#ffffff', this)"></button>
                    <button class="c-btn" style="background:#FFD1DC;" onclick="setFrame('#FFD1DC', this)"></button> <button class="c-btn" style="background:#FFF5BA;" onclick="setFrame('#FFF5BA', this)"></button> <button class="c-btn" style="background:#B5EAD7;" onclick="setFrame('#B5EAD7', this)"></button> </div>
            </div>

            <div class="control-group" style="padding-bottom: 30px;">
                <label class="label">üì∏ Choose Mood üì∏</label>
                <div class="mode-switch">
                    <div class="mode-bg" id="modeHighlight"></div>
                    <button class="m-btn active-text" onclick="setMode('color', 0, this)">Color</button>
                    <button class="m-btn" onclick="setMode('bw', 1, this)">B&W</button>
                </div>
            </div>

            <button class="big-btn" onclick="startCamera()">Let's Go! ‚ú®</button>
        </div>

        <div id="screen-cam" class="screen">
            <div class="camera-frame">
                <video id="video" autoplay playsinline muted></video>
                <div id="count" class="countdown-big">3</div>
            </div>
            <div class="strip-preview">
                <div class="mini-shot" id="p1"></div>
                <div class="mini-shot" id="p2"></div>
                <div class="mini-shot" id="p3"></div>
            </div>
            <p style="margin-top: 20px; font-size: 1.2rem;">Get ready to pose! ‚úåÔ∏è</p>
        </div>

        <div id="screen-result" class="screen">
            <img id="finalImg" class="paper-strip" alt="Photo Strip">
            <div id="endButtons" style="width:100%; margin-top: 30px; opacity: 0; transition: opacity 0.5s;">
                <button class="big-btn" onclick="downloadImg()">Save Photo üíñ</button>
                <button class="big-btn secondary" onclick="goHome()">Play Again ‚Ü∫</button>
            </div>
        </div>

    </div>

    <div class="flash" id="flashInfo"></div>
    <canvas id="renderCanvas" style="display: none;"></canvas>

    <script>
        const config = { frame: '#ffffff', mode: 'color' };
        const video = document.getElementById('video');
        const canvas = document.getElementById('renderCanvas');
        const ctx = canvas.getContext('2d');
        let stream, shots = [], audioCtx;

        // Sound (‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°)
        function playTone(freq, type, dur) {
            if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            if(audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain();
            osc.type = type; osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + dur);
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + dur);
        }
        function sfxBeep() { playTone(1000, 'sine', 0.1); }
        function sfxSnap() { playTone(200, 'square', 0.1); playTone(600, 'sawtooth', 0.05); }

        // UI Actions (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà)
        function setFrame(color, btn) {
            config.frame = color;
            document.querySelectorAll('.c-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }
        function setMode(mode, idx, btn) {
            config.mode = mode;
            document.getElementById('modeHighlight').style.transform = `translateX(${idx * 100 + (idx*8)}%)`;
            document.querySelectorAll('.m-btn').forEach(b => b.classList.remove('active-text'));
            btn.classList.add('active-text');
            video.style.filter = (mode === 'bw') ? 'grayscale(100%)' : 'none';
        }
        function switchScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        // Camera Logic (‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°)
        async function startCamera() {
            shots = []; [1,2,3].forEach(i => { document.getElementById(`p${i}`).classList.remove('taken'); document.getElementById(`p${i}`).innerHTML = ''; });
            try {
                stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user", width: 1280, height: 720 } });
                video.srcObject = stream; switchScreen('screen-cam'); setTimeout(runSequence, 1500);
            } catch(e) { alert("Please allow camera access."); }
        }
        async function runSequence() {
            for(let i=1; i<=3; i++) { await countdown(3); await capture(i); await new Promise(r => setTimeout(r, 800)); }
            finishSession();
        }
        function countdown(num) {
            return new Promise(resolve => {
                let c = num; const el = document.getElementById('count'); el.style.display = 'block'; el.innerText = c; sfxBeep();
                const t = setInterval(() => { c--; if(c>0){ el.innerText = c; sfxBeep(); } else { clearInterval(t); el.style.display='none'; resolve(); } }, 1000);
            });
        }
        function capture(idx) {
            return new Promise(resolve => {
                sfxSnap(); const f = document.getElementById('flashInfo'); f.style.opacity = 1; setTimeout(() => f.style.opacity = 0, 100);
                const w = video.videoWidth; const h = video.videoHeight;
                const tCan = document.createElement('canvas'); tCan.width = w; tCan.height = h; const tCtx = tCan.getContext('2d');
                tCtx.translate(w, 0); tCtx.scale(-1, 1); tCtx.drawImage(video, 0, 0, w, h);
                
                // Force B&W Logic
                if(config.mode === 'bw') {
                    tCtx.globalCompositeOperation = "saturation"; tCtx.fillStyle = "black"; tCtx.fillRect(0, 0, w, h); tCtx.globalCompositeOperation = "source-over";
                }
                shots.push(tCan);
                const thumb = document.getElementById(`p${idx}`); const img = new Image(); img.src = tCan.toDataURL(); thumb.appendChild(img); thumb.classList.add('taken');
                resolve();
            });
        }

        // Render Logic (‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏¥‡πâ‡∏ô‡∏ó‡πå)
        function finishSession() {
            if(stream) stream.getTracks().forEach(t => t.stop());
            const stripW = 600, photoW = 500, photoH = (photoW*3)/4, gap = 35, headH = 160, footH = 120;
            const totalH = headH + (photoH*3) + (gap*2) + footH;
            canvas.width = stripW; canvas.height = totalH;

            // 1. Background & Border
            ctx.fillStyle = config.frame; ctx.fillRect(0, 0, stripW, totalH);
            ctx.strokeStyle = '#4A4A4A'; ctx.lineWidth = 8; ctx.strokeRect(4, 4, stripW-8, totalH-8); // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡∏£‡∏π‡∏õ

            // 2. Header with Doodles
            ctx.fillStyle = '#4A4A4A'; ctx.textAlign = 'center'; 
            ctx.font = '800 50px "Patrick Hand"'; ctx.fillText("SENA", stripW/2, 70);
            ctx.font = '400 30px "Patrick Hand"'; ctx.fillText("PHOTOBOOTH", stripW/2, 110);
            
            // Cute Doodles on paper
            ctx.font = '40px "Patrick Hand"'; ctx.fillText("*", 60, 80); ctx.fillText("~", 540, 100);
            ctx.font = '30px "Patrick Hand"'; ctx.fillText("‚ô•", stripW/2, totalH - 90);

            // 3. Place Photos with Frames
            let y = headH;
            shots.forEach(shot => {
                // Draw photo border
                ctx.fillStyle = '#fff'; ctx.fillRect((stripW-photoW)/2 - 5, y - 5, photoW + 10, photoH + 10);
                ctx.strokeStyle = '#4A4A4A'; ctx.lineWidth = 4; ctx.strokeRect((stripW-photoW)/2 - 5, y - 5, photoW + 10, photoH + 10);

                const sRatio = shot.width / shot.height; const dRatio = 4/3; let sx, sy, sw, sh;
                if(sRatio > dRatio) { sh = shot.height; sw = sh * dRatio; sx = (shot.width - sw)/2; sy = 0; } 
                else { sw = shot.width; sh = sw / dRatio; sx = 0; sy = (shot.height - sh)/2; }
                ctx.drawImage(shot, sx, sy, sw, sh, (stripW-photoW)/2, y, photoW, photoH);
                y += photoH + gap;
            });

            // 4. Footer Date
            const now = new Date();
            const dateStr = now.toLocaleDateString('en-GB', { day:'numeric', month:'short', year:'numeric' });
            ctx.font = '400 20px "Patrick Hand"'; ctx.fillStyle = '#4A4A4A'; ctx.globalAlpha = 0.7;
            ctx.fillText(`${dateStr} ‚Ä¢ @SAPHASENA`, stripW/2, totalH - 40);

            const final = document.getElementById('finalImg'); final.src = canvas.toDataURL('image/jpeg', 0.95);
            switchScreen('screen-result'); setTimeout(() => { final.classList.add('show'); document.getElementById('endButtons').style.opacity = 1; }, 100);
        }

        function downloadImg() { const a = document.createElement('a'); a.download = `SENA-CUTE-${Date.now()}.jpg`; a.href = canvas.toDataURL('image/jpeg', 0.95); a.click(); }
        function goHome() { document.getElementById('finalImg').classList.remove('show'); document.getElementById('endButtons').style.opacity = 0; switchScreen('screen-home'); }
    </script>
</body>
</html>
