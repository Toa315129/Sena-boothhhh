<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SENA PHOTOBOOTH</title>

<link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">

<style>
:root{
  --cream:#FFF6D8;
  --blue:#EAF2FF;
  --ink:#1E2A44;
}

*{box-sizing:border-box;}
body{
  margin:0;
  height:100vh;
  font-family:'Patrick Hand', cursive;
  background:var(--cream);
  color:var(--ink);
}

.screen{display:none; height:100%; width:100%;}
.active{display:flex;}

.center{
  justify-content:center;
  align-items:center;
  flex-direction:column;
}

button{
  font-family:'Patrick Hand';
  padding:18px 36px;
  font-size:22px;
  border-radius:24px;
  border:3px solid var(--ink);
  background:var(--blue);
}

/* CAMERA */
.booth{
  display:flex;
  gap:20px;
  padding:20px;
}

.camera{
  width:60%;
  background:var(--blue);
  border:4px solid var(--ink);
  border-radius:28px;
  overflow:hidden;
  position:relative;
}

video{
  width:100%;
  height:100%;
  object-fit:cover;
}

#countdown{
  position:absolute;
  inset:0;
  display:none;
  justify-content:center;
  align-items:center;
  font-size:96px;
  color:white;
}

.preview{
  width:40%;
  display:flex;
  flex-direction:column;
  gap:14px;
}

.preview canvas{
  background:white;
  border:3px solid var(--ink);
  border-radius:14px;
  height:30%;
}
</style>
</head>

<body>

<!-- START -->
<div id="start" class="screen active center">
  <h1>SENA PHOTOBOOTH</h1>
  <p>‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ñ‡πà‡∏≤‡∏¢ üì∏</p>
  <button onclick="goMode()">START</button>
</div>

<!-- MODE -->
<div id="mode" class="screen center">
  <h2>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î‡∏†‡∏≤‡∏û</h2>
  <button onclick="selectMode('color')">COLOR</button><br><br>
  <button onclick="selectMode('mono')">MONO</button>
</div>

<!-- BOOTH -->
<div id="booth" class="screen">
  <div class="booth">
    <div class="camera">
      <video id="video" autoplay playsinline></video>
      <div id="countdown">3</div>
    </div>
    <div class="preview">
      <canvas width="240" height="320"></canvas>
      <canvas width="240" height="320"></canvas>
      <canvas width="240" height="320"></canvas>
    </div>
  </div>
  <div class="center">
    <button onclick="startShoot()">TAKE PHOTO</button>
  </div>
</div>

<!-- RESULT -->
<div id="result" class="screen center">
  <canvas id="final" width="420" height="1100"></canvas><br>
  <button onclick="download()">DOWNLOAD</button><br><br>
  <button onclick="reset()">FINISH</button>
</div>

<script>
const screens=document.querySelectorAll('.screen');
const video=document.getElementById('video');
const previews=document.querySelectorAll('.preview canvas');
const cd=document.getElementById('countdown');
const final=document.getElementById('final');
const fctx=final.getContext('2d');

let mode='color';
let shots=[];

function show(id){
  screens.forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function goMode(){ show('mode'); }

function selectMode(m){
  mode=m;
  show('booth');
  navigator.mediaDevices.getUserMedia({video:{facingMode:'user'}})
    .then(s=>video.srcObject=s);
}

function startShoot(){
  shots=[];
  previews.forEach(c=>c.getContext('2d').clearRect(0,0,c.width,c.height));
  take(0);
}

function take(i){
  if(i>=3){ makeFinal(); return; }

  let t=3;
  cd.style.display='flex';
  cd.textContent=t;

  const timer=setInterval(()=>{
    t--;
    cd.textContent=t;
    if(t===0){
      clearInterval(timer);
      cd.style.display='none';
      capture(i);
      setTimeout(()=>take(i+1),400);
    }
  },1000);
}

function capture(i){
  const temp=document.createElement('canvas');
  temp.width=video.videoWidth;
  temp.height=video.videoHeight;
  const ctx=temp.getContext('2d');
  ctx.drawImage(video,0,0);

  if(mode==='mono'){
    const img=ctx.getImageData(0,0,temp.width,temp.height);
    for(let p=0;p<img.data.length;p+=4){
      const g=img.data[p]*.3+img.data[p+1]*.59+img.data[p+2]*.11;
      img.data[p]=img.data[p+1]=img.data[p+2]=g;
    }
    ctx.putImageData(img,0,0);
  }

  shots.push(temp);
  drawCover(previews[i].getContext('2d'),temp,0,0,240,320);
}

function makeFinal(){
  show('result');
  fctx.fillStyle='white';
  fctx.fillRect(0,0,420,1100);
  let y=100;
  shots.forEach(s=>{
    drawCover(fctx,s,40,y,340,240);
    y+=270;
  });
  fctx.font='24px Patrick Hand';
  fctx.textAlign='center';
  fctx.fillText('SENAPHOTOBOOTH',210,1050);
}

function drawCover(ctx,img,x,y,w,h){
  const ir=img.width/img.height;
  const tr=w/h;
  let sx,sy,sw,sh;
  if(ir>tr){
    sh=img.height;
    sw=sh*tr;
    sx=(img.width-sw)/2; sy=0;
  }else{
    sw=img.width;
    sh=sw/tr;
    sx=0; sy=(img.height-sh)/2;
  }
  ctx.drawImage(img,sx,sy,sw,sh,x,y,w,h);
}

function download(){
  const a=document.createElement('a');
  a.href=final.toDataURL('image/png');
  a.download='SENA_PHOTOBOOTH.png';
  a.click();
}

function reset(){ show('start'); }
</script>
</body>
</html>
