<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SENA PHOTOBOOTH | Minimal Edition</title>
    <style>
        /* --- 1. Typography & Global Reset --- */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap');

        :root {
            --bg-color: #fafafa;
            --text-color: #1a1a1a;
            --accent-color: #1a1a1a;
            --glass-panel: rgba(255, 255, 255, 0.8);
            --shadow-soft: 0 10px 40px rgba(0,0,0,0.08);
            --transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        * { box-sizing: border-box; outline: none; }
        
        body {
            margin: 0;
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* --- 2. Layout & States --- */
        .app-container {
            width: 100%;
            max-width: 500px; /* Mobile/Tablet focus */
            height: 100%;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .screen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: var(--bg-color);
            transition: opacity 0.5s ease, transform 0.5s ease;
            opacity: 0;
            pointer-events: none;
            padding: 40px 20px;
        }

        .screen.active {
            opacity: 1;
            pointer-events: all;
            z-index: 10;
        }

        /* --- 3. Screen: Settings (Home) --- */
        h1 {
            font-weight: 600;
            font-size: 1.5rem;
            letter-spacing: -0.5px;
            margin-bottom: 40px;
            text-align: center;
        }

        .section-label {
            font-size: 0.85rem;
            color: #888;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        /* Color Picker */
        .color-options {
            display: flex;
            gap: 15px;
            margin-bottom: 40px;
        }
        .color-dot {
            width: 40px; height: 40px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: var(--transition);
        }
        .color-dot.selected {
            transform: scale(1.2);
            border-color: #000;
        }

        /* Filter Toggle */
        .filter-toggle {
            display: flex;
            background: #e0e0e0;
            border-radius: 30px;
            padding: 4px;
            margin-bottom: 60px;
            position: relative;
        }
        .filter-btn {
            padding: 10px 25px;
            border: none;
            background: transparent;
            font-family: inherit;
            font-weight: 500;
            cursor: pointer;
            z-index: 2;
            transition: color 0.3s;
            width: 100px;
        }
        .filter-bg {
            position: absolute;
            top: 4px; left: 4px;
            width: 100px; height: calc(100% - 8px);
            background: white;
            border-radius: 25px;
            transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .start-btn {
            background: #1a1a1a;
            color: white;
            border: none;
            padding: 18px 60px;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }
        .start-btn:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.2); }

        /* --- 4. Screen: Viewfinder (Capture) --- */
        .viewfinder {
            width: 100%;
            aspect-ratio: 3/4;
            background: #000;
            border-radius: 20px;
            overflow: hidden;
            position: relative;
            box-shadow: var(--shadow-soft);
        }

        video {
            width: 100%; height: 100%;
            object-fit: cover;
            transform: scaleX(-1); /* Mirror */
        }

        /* Grid Overlay */
        .grid-lines {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
        }
        .grid-lines::before, .grid-lines::after {
            content: ''; position: absolute; background: rgba(255,255,255,0.2);
        }
        /* Vertical lines */
        .grid-lines::before { top: 0; bottom: 0; left: 33.33%; width: 33.33%; border-left: 1px solid rgba(255,255,255,0.2); border-right: 1px solid rgba(255,255,255,0.2); }
        /* Horizontal lines */
        .grid-lines::after { left: 0; right: 0; top: 33.33%; height: 33.33%; border-top: 1px solid rgba(255,255,255,0.2); border-bottom: 1px solid rgba(255,255,255,0.2); }

        .counter-display {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 8rem;
            color: white;
            font-weight: 300;
            display: none;
        }

        .flash-overlay {
            position: absolute; top:0; left:0; right:0; bottom:0;
            background: white;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.05s;
        }

        .status-indicator {
            position: absolute;
            top: 20px; right: 20px;
            display: flex; align-items: center; gap: 8px;
            background: rgba(0,0,0,0.5);
            padding: 5px 12px;
            border-radius: 20px;
            color: white;
            font-size: 0.75rem;
            backdrop-filter: blur(4px);
        }
        .red-dot {
            width: 8px; height: 8px; background: #ff4757; border-radius: 50%;
            animation: pulse 1s infinite;
        }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }

        /* --- 5. Screen: Result --- */
        .result-stage {
            perspective: 1000px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .photo-strip {
            max-height: 70vh;
            width: auto;
            box-shadow: 0 20px 50px rgba(0,0,0,0.2);
            transform: rotateX(10deg) translateY(50px);
            opacity: 0;
            transition: var(--transition);
        }

        .photo-strip.printed {
            transform: rotateX(0deg) translateY(0);
            opacity: 1;
        }

        .action-buttons {
            margin-top: 30px;
            display: flex;
            gap: 15px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease 0.5s; /* Delay for print animation */
        }
        
        .action-buttons.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .btn-secondary {
            background: white;
            border: 1px solid #ddd;
            padding: 12px 25px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .btn-primary {
            background: #1a1a1a;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
        }

    </style>
</head>
<body>

    <div class="app-container">
        
        <div id="screen-start" class="screen active">
            <h1>SENA PHOTOBOOTH</h1>
            
            <div class="section-label">Select Frame</div>
            <div class="color-options">
                <div class="color-dot selected" style="background: #ffffff; border: 1px solid #ddd;" onclick="setFrameColor('#ffffff', this)"></div>
                <div class="color-dot" style="background: #1a1a1a;" onclick="setFrameColor('#1a1a1a', this)"></div>
                <div class="color-dot" style="background: #f7d794;" onclick="setFrameColor('#f7d794', this)"></div>
                <div class="color-dot" style="background: #fab1a0;" onclick="setFrameColor('#fab1a0', this)"></div>
                <div class="color-dot" style="background: #81ecec;" onclick="setFrameColor('#81ecec', this)"></div>
            </div>

            <div class="section-label">Select Mood</div>
            <div class="filter-toggle">
                <div class="filter-bg" id="filterBg"></div>
                <button class="filter-btn" onclick="setFilter('normal', 0)">Color</button>
                <button class="filter-btn" onclick="setFilter('bw', 1)">B&W</button>
            </div>

            <button class="start-btn" onclick="startSession()">START SESSION</button>
        </div>

        <div id="screen-capture" class="screen">
            <div class="status-indicator">
                <div class="red-dot"></div>
                <span>REC</span>
            </div>
            
            <div class="viewfinder">
                <video id="video" autoplay playsinline></video>
                <div class="grid-lines"></div>
                <div id="countdownDisplay" class="counter-display">3</div>
                <div id="flash" class="flash-overlay"></div>
            </div>
            
            <p style="margin-top: 20px; font-size: 0.9rem; color: #666;">Get ready for 3 shots...</p>
        </div>

        <div id="screen-result" class="screen">
            <div class="result-stage">
                <img id="finalResult" class="photo-strip" alt="Photo Booth Strip">
            </div>
            
            <div class="action-buttons" id="actionButtons">
                <button class="btn-secondary" onclick="resetApp()">Take Another</button>
                <button class="btn-primary" onclick="downloadStrip()">Download Photo</button>
            </div>
        </div>

    </div>

    <canvas id="processingCanvas" style="display: none;"></canvas>

    <script>
        // --- Configuration & State ---
        const config = {
            frameColor: '#ffffff',
            textColor: '#000000',
            filter: 'normal', // normal, bw
            shots: 3,
            countdown: 3
        };

        let stream = null;
        let capturedImages = [];
        const video = document.getElementById('video');
        const canvas = document.getElementById('processingCanvas');
        const ctx = canvas.getContext('2d');

        // --- Audio Context (Synthesized Sounds) ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playBeep() {
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            oscillator.type = 'sine';
            oscillator.frequency.value = 800; // High pitch beep
            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.1);
            
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.1);
        }

        function playShutter() {
            // Noise burst for shutter sound
            const bufferSize = audioCtx.sampleRate * 0.1; // 0.1 seconds
            const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const data = buffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) {
                data[i] = Math.random() * 2 - 1;
            }

            const noise = audioCtx.createBufferSource();
            noise.buffer = buffer;
            const gainNode = audioCtx.createGain();
            
            gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            
            noise.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            noise.start();
        }

        // --- UI Logic ---
        function setFrameColor(color, el) {
            config.frameColor = color;
            // Adjust text color based on background brightness
            config.textColor = (color === '#1a1a1a') ? '#ffffff' : '#000000';

            document.querySelectorAll('.color-dot').forEach(d => d.classList.remove('selected'));
            el.classList.add('selected');
        }

        function setFilter(type, index) {
            config.filter = type;
            const bg = document.getElementById('filterBg');
            bg.style.transform = `translateX(${index * 100}%)`;
            
            // Preview Filter
            if(type === 'bw') {
                video.style.filter = 'grayscale(100%) contrast(1.2)';
            } else {
                video.style.filter = 'none';
            }
        }

        function switchScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        // --- Camera & Capture Logic ---
        async function startSession() {
            // Audio Context must be resumed on user gesture
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            capturedImages = [];
            
            try {
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { width: { ideal: 1920 }, height: { ideal: 1080 }, facingMode: "user" } 
                });
                video.srcObject = stream;
                switchScreen('screen-capture');
                
                // Wait a moment for camera to settle then start sequence
                setTimeout(runCaptureSequence, 1500);
            } catch (e) {
                alert("Camera access denied. Please allow camera access to use the booth.");
            }
        }

        async function runCaptureSequence() {
            for (let i = 0; i < config.shots; i++) {
                await doCountdown();
                await takePhoto();
                await new Promise(r => setTimeout(r, 1000)); // Review pause
            }
            finishSession();
        }

        function doCountdown() {
            return new Promise(resolve => {
                let count = config.countdown;
                const el = document.getElementById('countdownDisplay');
                el.style.display = 'block';
                el.innerText = count;
                playBeep();

                const timer = setInterval(() => {
                    count--;
                    if (count > 0) {
                        el.innerText = count;
                        playBeep();
                    } else {
                        clearInterval(timer);
                        el.style.display = 'none';
                        resolve();
                    }
                }, 1000);
            });
        }

        function takePhoto() {
            return new Promise(resolve => {
                playShutter();
                const flash = document.getElementById('flash');
                flash.style.opacity = 1;
                setTimeout(() => flash.style.opacity = 0, 100);

                // Capture Frame to Canvas
                const w = video.videoWidth;
                const h = video.videoHeight;
                const tempCanvas = document.createElement('canvas');
                tempCanvas.width = w;
                tempCanvas.height = h;
                const tCtx = tempCanvas.getContext('2d');
                
                // Mirror capture
                tCtx.translate(w, 0);
                tCtx.scale(-1, 1);
                
                if (config.filter === 'bw') {
                    tCtx.filter = 'grayscale(100%) contrast(1.2)';
                }
                
                tCtx.drawImage(video, 0, 0, w, h);
                capturedImages.push(tempCanvas);
                resolve();
            });
        }

        // --- Processing Logic (The Strip) ---
        function finishSession() {
            // Stop Camera
            stream.getTracks().forEach(track => track.stop());
            
            // Build Strip
            renderStrip();
            
            switchScreen('screen-result');
            
            // Trigger Animation
            setTimeout(() => {
                document.getElementById('finalResult').classList.add('printed');
                document.getElementById('actionButtons').classList.add('visible');
            }, 100);
        }

        function renderStrip() {
            const dpi = 2; // For high res
            const stripW = 600;
            const photoW = 520;
            const photoH = (photoW * 3) / 4; // 4:3 Aspect Ratio
            const gap = 30;
            const topPad = 120;
            const bottomPad = 150;
            
            const totalH = topPad + (photoH * 3) + (gap * 2) + bottomPad;
            
            canvas.width = stripW;
            canvas.height = totalH;

            // Background
            ctx.fillStyle = config.frameColor;
            ctx.fillRect(0, 0, stripW, totalH);
            
            // Header Text
            ctx.fillStyle = config.textColor;
            ctx.font = '600 32px "Inter"';
            ctx.textAlign = 'center';
            ctx.letterSpacing = '2px';
            ctx.fillText("SENA PHOTOBOOTH", stripW / 2, 70);
            
            ctx.font = '400 14px "Inter"';
            ctx.fillText("@SAPHASENA", stripW / 2, 95);

            // Draw Photos
            let y = topPad;
            capturedImages.forEach(img => {
                // Crop logic to fit 4:3 perfectly
                const srcRatio = img.width / img.height;
                const destRatio = 4 / 3;
                let sW, sH, sX, sY;

                if (srcRatio > destRatio) {
                    sH = img.height;
                    sW = sH * destRatio;
                    sX = (img.width - sW) / 2;
                    sY = 0;
                } else {
                    sW = img.width;
                    sH = sW / destRatio;
                    sX = 0;
                    sY = (img.height - sH) / 2;
                }

                ctx.drawImage(img, sX, sY, sW, sH, (stripW - photoW)/2, y, photoW, photoH);
                y += photoH + gap;
            });

            // Footer (Date & Time)
            const date = new Date();
            const dateStr = date.toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' });
            const timeStr = date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
            
            ctx.fillStyle = config.textColor;
            ctx.globalAlpha = 0.6;
            ctx.font = '400 18px "Inter"';
            ctx.fillText(`${dateStr} â€¢ ${timeStr}`, stripW / 2, totalH - 60);
            ctx.globalAlpha = 1.0;

            // Output
            document.getElementById('finalResult').src = canvas.toDataURL('image/jpeg', 0.95);
        }

        function downloadStrip() {
            const link = document.createElement('a');
            link.download = `SENA-PHOTOBOOTH-${Date.now()}.jpg`;
            link.href = canvas.toDataURL('image/jpeg', 0.95);
            link.click();
        }

        function resetApp() {
            document.getElementById('finalResult').classList.remove('printed');
            document.getElementById('actionButtons').classList.remove('visible');
            switchScreen('screen-start');
        }
    </script>
</body>
</html>
