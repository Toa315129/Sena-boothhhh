<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>SENA PHOTOBOOTH</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;}

body{
    margin:0;
    font-family:'Helvetica Neue', Arial, sans-serif;
    background:#f7f6f3;
    height:100vh;
    overflow:hidden;
    user-select:none;
    color:#222;
}

/* ดาว */
.star{
    position:fixed;
    font-size:14px;
    color:#bbb;
}
.star.s1{top:40px;left:30px;}
.star.s2{top:120px;right:50px;}
.star.s3{bottom:80px;left:60px;}
.star.s4{bottom:40px;right:80px;}

.screen{
    display:none;
    width:100%;
    height:100%;
    justify-content:center;
    align-items:center;
    flex-direction:column;
}
.active{display:flex;}

h1{
    font-weight:500;
    letter-spacing:4px;
    margin-bottom:20px;
}

p{margin:10px 0;font-size:16px;}

button{
    padding:16px 42px;
    margin:8px;
    font-size:18px;
    border-radius:14px;
    border:1px solid #ddd;
    background:white;
    cursor:pointer;
}
button:hover{background:#f0f0f0;}

.primary{
    background:#111;
    color:white;
    border:none;
}
.primary:hover{background:#000;}

.camera{
    width:360px;
    aspect-ratio:3/4;
    background:#000;
    border-radius:18px;
    overflow:hidden;
    position:relative;
    box-shadow:0 10px 30px rgba(0,0,0,.2);
}

video,canvas{
    width:100%;
    height:100%;
    object-fit:cover;
}

#countdown{
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    font-size:90px;
    color:white;
    display:none;
}

.frame-btn{
    padding:14px 28px;
    border-radius:14px;
    font-size:16px;
}
.f1{background:#ffffff;}
.f2{background:#f2efe9;}
.f3{background:#e6e6e6;}
.f4{background:#000;color:white;}

#final{
    background:white;
    border-radius:16px;
    box-shadow:0 10px 30px rgba(0,0,0,.2);
}

.footer{
    margin-top:12px;
    font-size:12px;
    letter-spacing:2px;
    color:#555;
}

@media print{
    body *{visibility:hidden;}
    #final{visibility:visible;position:absolute;top:0;left:0;}
}
</style>
</head>

<body>

<!-- ดาว -->
<div class="star s1">✦</div>
<div class="star s2">✦</div>
<div class="star s3">✦</div>
<div class="star s4">✦</div>

<!-- HOME -->
<div id="home" class="screen active">
    <h1>SENA PHOTOBOOTH</h1>
    <button class="primary" onclick="show('coin')">START</button>
</div>

<!-- COIN -->
<div id="coin" class="screen">
    <h1>INSERT COIN</h1>
    <p id="coinText">0 / 10 BAHT</p>
    <button onclick="insertCoin()">+10</button>
</div>

<!-- FRAME -->
<div id="frame" class="screen">
    <h1>FRAME COLOR</h1>
    <button class="frame-btn f1" onclick="setFrame('#ffffff')">WHITE</button>
    <button class="frame-btn f2" onclick="setFrame('#f2efe9')">CREAM</button>
    <button class="frame-btn f3" onclick="setFrame('#e6e6e6')">GRAY</button>
    <button class="frame-btn f4" onclick="setFrame('#000000')">BLACK</button>
</div>

<!-- MODE -->
<div id="mode" class="screen">
    <h1>MODE</h1>
    <button onclick="selectMode('color')">COLOR</button>
    <button onclick="selectMode('mono')">MONO</button>
</div>

<!-- BOOTH -->
<div id="booth" class="screen">
    <h1>SENA PHOTOBOOTH</h1>
    <div class="camera">
        <video id="video" autoplay playsinline></video>
        <canvas id="canvas" style="display:none;"></canvas>
        <div id="countdown">3</div>
    </div>
    <div class="footer">✦ โรงเรียนตะกั่วป่าเสนานุกูล ✦</div>
</div>

<!-- RESULT -->
<div id="result" class="screen">
    <h1>YOUR PHOTO</h1>
    <canvas id="final" width="800" height="2000"></canvas>
    <button class="primary" onclick="window.print()">PRINT</button>
    <button onclick="download()">DOWNLOAD</button>
    <button onclick="reset()">FINISH</button>
</div>

<script>
let coin=0,price=10,frame="#fff",mode="color";
let shots=[],count=0;

const video=document.getElementById("video");
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");
const final=document.getElementById("final");
const fctx=final.getContext("2d");
const cd=document.getElementById("countdown");

function show(id){
    document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
}

function insertCoin(){
    coin+=10;
    document.getElementById("coinText").innerText=`${coin} / ${price} BAHT`;
    if(coin>=price) show('frame');
}

function setFrame(c){frame=c;show('mode');}

function selectMode(m){
    mode=m;show('booth');
    navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}})
    .then(s=>video.srcObject=s);
    shots=[];count=0;
    setTimeout(nextShot,1000);
}

function nextShot(){
    if(count>=4){makeStrip();return;}
    let c=3;cd.style.display="block";cd.innerText=c;
    let t=setInterval(()=>{
        c--;cd.innerText=c;
        if(c==0){clearInterval(t);cd.style.display="none";take();}
    },1000);
}

function take(){
    canvas.width=video.videoWidth;
    canvas.height=video.videoHeight;
    ctx.drawImage(video,0,0);
    if(mode=="mono"){
        let img=ctx.getImageData(0,0,canvas.width,canvas.height);
        for(let i=0;i<img.data.length;i+=4){
            let a=(img.data[i]+img.data[i+1]+img.data[i+2])/3;
            img.data[i]=img.data[i+1]=img.data[i+2]=a;
        }
        ctx.putImageData(img,0,0);
    }
    shots.push(canvas.toDataURL());
    count++;setTimeout(nextShot,700);
}

function makeStrip(){
    show('result');
    fctx.fillStyle=frame;
    fctx.fillRect(0,0,800,2000);
    let y=100;
    shots.forEach(s=>{
        let i=new Image();
        i.onload=()=>fctx.drawImage(i,100,y,600,400);
        i.src=s;y+=450;
    });
    setTimeout(()=>{
        fctx.fillStyle=frame=="#000"?"#fff":"#000";
        fctx.font="36px Arial";
        fctx.textAlign="center";
        fctx.fillText("✦ SENA PHOTOBOOTH ✦",400,1900);
    },500);
}

function download(){
    let a=document.createElement("a");
    a.download="SENA_PHOTOBOOTH.png";
    a.href=final.toDataURL();
    a.click();
}

function reset(){
    coin=0;show('home');
}
</script>

</body>
</html>
