<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SENA SKETCH BOOTH</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #F8F8F8;
            --card-bg: #FFFFFF;
            --stroke: #121212;
            --stroke-width: 3px;
            --shadow-offset: 4px;
            --radius: 12px;
            
            /* Colors */
            --c-white: #ffffff;
            --c-cream: #FFF5E1;
            --c-black: #121212;
            --c-blue: #CDE8FF;
            --c-rainbow: linear-gradient(135deg, #FFC3A0 0%, #FFAFBD 100%);

            --font-main: 'Patrick Hand', cursive;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; user-select: none; }

        body {
            margin: 0;
            background-color: var(--bg-color);
            background-image: radial-gradient(#ddd 1.5px, transparent 1.5px);
            background-size: 24px 24px;
            font-family: var(--font-main);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            color: var(--stroke);
        }

        /* --- CONTAINER: The "Sketch" Box --- */
        .app-shell {
            width: 100%; max-width: 440px; height: 94vh;
            background: var(--card-bg);
            border: var(--stroke-width) solid var(--stroke);
            border-radius: 20px;
            position: relative; overflow: hidden;
            box-shadow: 8px 8px 0px rgba(0,0,0,0.1);
            display: flex; flex-direction: column;
        }

        .screen {
            position: absolute; inset: 0;
            display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
            padding: 30px 20px;
            background: var(--card-bg);
            transition: opacity 0.3s ease;
            opacity: 0; pointer-events: none; z-index: 1;
        }
        .screen.active { opacity: 1; pointer-events: all; z-index: 10; }

        /* --- TYPOGRAPHY & UI --- */
        h1 { font-size: 3.5rem; margin: 10px 0 5px 0; line-height: 1; text-align: center; }
        p { font-size: 1.2rem; margin: 0 0 30px 0; color: #666; text-align: center; }

        .label { font-size: 1.3rem; margin-bottom: 10px; display: block; width: 100%; text-align: left; }

        /* Custom Checkbox/Radio Groups */
        .opt-group {
            display: flex; gap: 10px; width: 100%; margin-bottom: 25px;
            overflow-x: auto; padding-bottom: 5px;
        }
        
        .opt-btn {
            flex: 1; min-width: 60px; height: 50px;
            border: 2px solid #ddd; border-radius: var(--radius);
            background: #fff; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            font-family: var(--font-main); font-size: 1.1rem;
            transition: all 0.2s; position: relative;
        }
        .opt-btn.active {
            border: var(--stroke-width) solid var(--stroke);
            box-shadow: 3px 3px 0px var(--stroke);
            transform: translate(-1px, -1px);
            color: var(--stroke); font-weight: bold; background: #fff;
        }
        
        /* Color Circles inside buttons */
        .dot { width: 20px; height: 20px; border-radius: 50%; border: 1px solid #ddd; }

        /* Big Action Button */
        .btn-main {
            width: 100%; padding: 15px; margin-top: auto;
            background: var(--stroke); color: #fff;
            border: var(--stroke-width) solid var(--stroke);
            border-radius: 15px;
            font-family: var(--font-main); font-size: 1.8rem;
            cursor: pointer;
            box-shadow: 4px 4px 0px rgba(0,0,0,0.2);
            transition: transform 0.1s;
        }
        .btn-main:active { transform: translate(2px, 2px); box-shadow: 2px 2px 0px rgba(0,0,0,0.2); }
        .btn-main.outline { background: #fff; color: var(--stroke); }

        /* --- CAMERA UI --- */
        .cam-container {
            width: 100%; aspect-ratio: 3/4;
            background: #000; border-radius: var(--radius);
            border: var(--stroke-width) solid var(--stroke);
            position: relative; overflow: hidden;
            box-shadow: 6px 6px 0px #eee;
        }
        video { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); }
        
        .countdown {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 6rem; color: #fff; text-shadow: 3px 3px 0px #000; display: none;
        }

        /* --- PRINTING ANIMATION (Clear Box) --- */
        #screen-print { justify-content: flex-start; padding-top: 0; overflow: hidden; }
        
        /* The Slot */
        .slot-header {
            width: 100%; height: 60px; background: var(--stroke);
            display: flex; align-items: flex-end; justify-content: center;
            position: absolute; top: 0; left: 0; z-index: 20;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .slot-hole { width: 220px; height: 8px; background: #333; border-radius: 4px; margin-bottom: 10px; }

        .print-stage {
            position: relative; width: 100%; height: 100%;
            display: flex; justify-content: center;
        }

        .paper {
            width: 240px; height: auto;
            border: 2px solid var(--stroke);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            position: absolute; top: -400px; /* Start Hidden above */
            z-index: 5;
        }

        /* Animations */
        .paper.anim-print { animation: slideOut 3.5s cubic-bezier(0.45, 0, 0.55, 1) forwards; }
        .paper.anim-drop { animation: dropBox 0.6s ease-in forwards; }

        @keyframes slideOut {
            0% { top: -400px; }
            100% { top: 60px; } /* Stops just below slot */
        }
        @keyframes dropBox {
            0% { top: 60px; transform: rotate(0deg); }
            100% { top: 55%; transform: rotate(-5deg); } /* Drop into box */
        }

        /* The Clear Box (Acrylic Tray) */
        .tray {
            position: absolute; bottom: 140px;
            width: 280px; height: 120px;
            background: rgba(255, 255, 255, 0.5); /* Semi-transparent */
            border: 3px solid rgba(18, 18, 18, 0.2); /* Sketchy light border */
            border-top: none;
            border-radius: 0 0 20px 20px;
            z-index: 30;
            backdrop-filter: blur(4px);
            display: flex; align-items: center; justify-content: center;
        }
        /* Shine on glass */
        .tray::after {
            content: ''; position: absolute; top: 10px; right: 10px;
            width: 20px; height: 60px; background: rgba(255,255,255,0.6);
            border-radius: 10px; transform: rotate(20deg);
        }

        .action-bar {
            position: absolute; bottom: 20px; width: 90%;
            display: flex; flex-direction: column; gap: 10px;
            opacity: 0; transition: opacity 0.5s; z-index: 40;
        }

        /* Flash */
        .flash { position: fixed; inset:0; background:white; opacity:0; pointer-events:none; z-index:99; transition:0.1s;}
    </style>
</head>
<body>

    <div class="app-shell">

        <div id="screen-home" class="screen active">
            <div style="flex:1; display:flex; flex-direction:column; justify-content:center; width:100%;">
                <h1>SENA<br>BOOTH</h1>
                <p>Sketch Studio Edition</p>

                <span class="label">1. Choose Frame</span>
                <div class="opt-group">
                    <div class="opt-btn active" onclick="setFrame('white', this)"><div class="dot" style="background:#fff"></div></div>
                    <div class="opt-btn" onclick="setFrame('cream', this)"><div class="dot" style="background:#FFF5E1"></div></div>
                    <div class="opt-btn" onclick="setFrame('blue', this)"><div class="dot" style="background:#CDE8FF"></div></div>
                    <div class="opt-btn" onclick="setFrame('black', this)"><div class="dot" style="background:#000"></div></div>
                    <div class="opt-btn" onclick="setFrame('rainbow', this)"><div class="dot" style="background:linear-gradient(45deg, #ff9a9e, #fad0c4)"></div></div>
                </div>

                <span class="label">2. Choose Mood</span>
                <div class="opt-group">
                    <div class="opt-btn active" onclick="setMode('normal', this)">Color</div>
                    <div class="opt-btn" onclick="setMode('film', this)">Film</div>
                    <div class="opt-btn" onclick="setMode('bw', this)">B&W</div>
                </div>
            </div>

            <button class="btn-main" onclick="startCamera()">Start Photo</button>
        </div>

        <div id="screen-cam" class="screen">
            <h2>Get Ready!</h2>
            <div class="cam-container">
                <video id="video" autoplay playsinline muted></video>
                <div id="count" class="countdown">3</div>
            </div>
            <p style="margin-top:20px" id="status-text">Pose 1 of 3</p>
        </div>

        <div id="screen-print" class="screen">
            <div class="slot-header">
                <div class="slot-hole"></div>
            </div>

            <div class="print-stage">
                <img id="print-paper" class="paper" alt="Photo">
                <div class="tray"></div> </div>

            <div class="action-bar" id="end-actions">
                <button class="btn-main" onclick="downloadImg()">Download Image</button>
                <button class="btn-main outline" onclick="reset()">Back to Home</button>
            </div>
        </div>

    </div>

    <div class="flash" id="flash"></div>
    <canvas id="canvas" style="display: none;"></canvas>

    <script>
        // --- CONFIG ---
        const config = { frame: 'white', mode: 'normal' };
        const colors = {
            white: '#ffffff', cream: '#FFF5E1', black: '#121212', blue: '#CDE8FF',
            rainbow: 'rainbow'
        };
        let stream, audioCtx, shots = [];
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        // --- AUDIO ---
        function playSound(type) {
            if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            if(audioCtx.state === 'suspended') audioCtx.resume();
            const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
            
            if(type === 'beep') { o.frequency.value = 800; g.gain.value = 0.05; o.start(); o.stop(audioCtx.currentTime+0.1); }
            if(type === 'snap') { 
                o.type='square'; o.frequency.value=150; g.gain.value=0.1; 
                g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime+0.1);
                o.start(); o.stop(audioCtx.currentTime+0.1);
            }
            o.connect(g); g.connect(audioCtx.destination);
        }

        // --- UI LOGIC ---
        function setFrame(v, el) { 
            config.frame = v; 
            document.querySelectorAll('.opt-group:nth-of-type(1) .opt-btn').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
        }
        function setMode(v, el) { 
            config.mode = v;
            document.querySelectorAll('.opt-group:nth-of-type(2) .opt-btn').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
        }

        // --- CAMERA ---
        async function startCamera() {
            try {
                stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user', width: 1280, height: 720 } });
                video.srcObject = stream;
                
                // Filter Preview
                let f = 'none';
                if(config.mode === 'bw') f = 'grayscale(100%)';
                if(config.mode === 'film') f = 'sepia(30%) contrast(110%) saturate(90%)';
                video.style.filter = f;

                switchScreen('screen-cam');
                setTimeout(runSequence, 1000);
            } catch(e) { alert('Camera access required'); }
        }

        async function runSequence() {
            shots = [];
            for(let i=1; i<=3; i++) {
                document.getElementById('status-text').innerText = `Pose ${i} / 3`;
                await countdown(3);
                await capture();
            }
            finish();
        }

        function countdown(n) {
            return new Promise(r => {
                let c = n;
                const el = document.getElementById('count');
                el.style.display = 'block'; el.innerText = c; playSound('beep');
                const t = setInterval(() => {
                    c--;
                    if(c>0) { el.innerText = c; playSound('beep'); }
                    else { clearInterval(t); el.style.display='none'; r(); }
                }, 1000);
            });
        }

        function capture() {
            return new Promise(r => {
                playSound('snap');
                const f = document.getElementById('flash');
                f.style.opacity = 1; setTimeout(() => f.style.opacity = 0, 100);

                const w = video.videoWidth; const h = video.videoHeight;
                const tc = document.createElement('canvas');
                tc.width = w; tc.height = h;
                const tctx = tc.getContext('2d');
                
                tctx.translate(w, 0); tctx.scale(-1, 1);
                tctx.drawImage(video, 0, 0, w, h);

                // Apply Canvas Filters
                if(config.mode === 'bw') {
                    tctx.globalCompositeOperation = 'saturation';
                    tctx.fillStyle = '#000';
                    tctx.fillRect(0,0,w,h);
                } else if(config.mode === 'film') {
                    tctx.globalCompositeOperation = 'overlay';
                    tctx.fillStyle = 'rgba(255, 220, 150, 0.15)';
                    tctx.fillRect(0,0,w,h);
                }

                shots.push(tc);
                setTimeout(r, 800);
            });
        }

        // --- RENDER ---
        function finish() {
            if(stream) stream.getTracks().forEach(t => t.stop());

            const stripW = 600; const totalH = 1600;
            const photoW = 520; const photoH = (photoW*3)/4;
            const gap = 30; let y = 160;

            canvas.width = stripW; canvas.height = totalH;

            // Background
            if(config.frame === 'rainbow') {
                const g = ctx.createLinearGradient(0,0,stripW,totalH);
                g.addColorStop(0, '#ff9a9e'); g.addColorStop(1, '#fad0c4');
                ctx.fillStyle = g;
            } else { ctx.fillStyle = colors[config.frame]; }
            ctx.fillRect(0,0,stripW,totalH);

            // Border Frame
            ctx.strokeStyle = '#121212'; ctx.lineWidth = 6;
            ctx.strokeRect(4,4,stripW-8,totalH-8);

            // Header
            ctx.fillStyle = (config.frame==='black') ? '#fff' : '#121212';
            ctx.textAlign = 'center'; 
            ctx.font = '80px "Patrick Hand"'; ctx.fillText("SENA", stripW/2, 90);
            ctx.font = '40px "Patrick Hand"'; ctx.fillText("SKETCH BOOTH", stripW/2, 135);

            // Photos
            shots.forEach(s => {
                // Crop Logic
                const sR = s.width/s.height; const dR = 4/3;
                let sx, sy, sw, sh;
                if(sR > dR) { sh=s.height; sw=sh*dR; sx=(s.width-sw)/2; sy=0; }
                else { sw=s.width; sh=sw/dR; sx=0; sy=(s.height-sh)/2; }

                ctx.drawImage(s, sx, sy, sw, sh, (stripW-photoW)/2, y, photoW, photoH);
                
                // Photo Border
                ctx.strokeStyle = (config.frame==='black')?'#fff':'#121212';
                ctx.lineWidth = 4;
                ctx.strokeRect((stripW-photoW)/2, y, photoW, photoH);
                
                y += photoH + gap;
            });

            // Footer
            ctx.font = '30px "Patrick Hand"';
            ctx.fillText(new Date().toLocaleDateString(), stripW/2, totalH-50);

            // Display & Animate
            const img = document.getElementById('print-paper');
            img.src = canvas.toDataURL('image/jpeg', 0.95);
            
            switchScreen('screen-print');
            
            // Animation Sequence
            setTimeout(() => {
                img.classList.add('anim-print'); // Slide Down
                setTimeout(() => {
                    img.classList.remove('anim-print');
                    img.classList.add('anim-drop'); // Drop to Box
                    setTimeout(() => {
                        document.getElementById('end-actions').style.opacity = 1;
                    }, 800);
                }, 3500); // Print Duration
            }, 500);
        }

        function switchScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }
        function downloadImg() {
            const a = document.createElement('a');
            a.download = 'SENA-SKETCH.jpg';
            a.href = canvas.toDataURL('image/jpeg', 1.0);
            a.click();
        }
        function reset() { location.reload(); }

    </script>
</body>
</html>
